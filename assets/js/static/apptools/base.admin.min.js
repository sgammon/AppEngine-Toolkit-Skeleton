(function(){var a,b,c,d,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q=Array.prototype.slice,R=Object.prototype.hasOwnProperty,S=function(a,b){function d(){this.constructor=a}for(var c in b)R.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},T=Array.prototype.indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1},U=function(a,b){return function(){return a.apply(b,arguments)}};this.__apptools_preinit={},P={},C=function(a,b,c){var d,e,f,g,h,i,j,k;c==null&&(c=null);if(a===".")return b[b.length-1];j=a.split(/\./),a=j[0],g=2<=j.length?Q.call(j,1):[];for(e=k=b.length-1;k<=-1?e<-1:e>-1;k<=-1?e++:e--){if(b[e]==null)continue;if(typeof b[e]=="object"&&a in(d=b[e])){c=d[a];break}continue}for(h=0,i=g.length;h<i;h++)f=g[h],c=C(f,[c]);return c instanceof Function&&(c=function(a){return function(){var b;return b=a.apply(d,arguments),b instanceof Function&&b.apply(null,arguments)||b}}(c)),c},B=function(){var a,b,c,d;return c=arguments[0],d=arguments[1],a=3<=arguments.length?Q.call(arguments,2):[],function(){var e,f,g;g=[];for(e=0,f=d.length;e<f;e++)b=d[e],g.push(b.call.apply(b,[c].concat(Q.call(a))));return g}().join("")},F=function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,D,E,G;b==null&&(b=["{{","}}"]),c==null&&(c=null),j=P[A=b.join(" ")]||(P[A]={});if(a in j)return j[a];e=[],d=function(){var a,c;return c=b[0],a=b[1],RegExp("([\\s\\S]*?)([ \\t]*)(?:"+c+"\\s*(?:(!)\\s*([\\s\\S]+?)|(=)\\s*([\\s\\S]+?)\\s*=|({)\\s*(\\w[\\S]*?)\\s*}|([^0-9a-zA-Z._!={]?)\\s*([\\w.][\\S]*?))\\s*"+a+")","gm")},w=d(),w.lastIndex=t=(c||{start:0}).start,s=function(b,c){var d,e,f,g,h,i,j,k,m,n,o;(f=/$/gm).lastIndex=b,f.exec(a),n=a.substr(0,b).split("\n"),m=n.length,j=n[m-1],o=l+z.length,k=a.substr(o+1,b-o-1),h=(new Array(j.length-k.length+1)).join(" "),d=(new Array(k.length+1)).join("^"),j+=a.substr(b,f.lastIndex-b),g=new Error;for(i in e={message:""+c+"\n\nLine "+m+":\n"+j+"\n"+h+d,error:c,line:m,"char":h.length,tag:k})g[i]=e[i];return g};while(q=w.exec(a)){D=q.slice(1,3),k=D[0],z=D[1],y=q[3]||q[5]||q[7]||q[9],v=q[4]||q[6]||q[8]||q[10],l=t+k.length-1,t=w.lastIndex,p=(l===-1||a.charAt(l)==="\n")&&((E=a.charAt(t))===void 0||E===""||E==="\r"||E==="\n"),k&&e.push(function(a){return function(){return a}}(k)),p&&y!==""&&y!=="&"&&y!=="{"?(a.charAt(t)==="\r"&&(t+=1),a.charAt(t)==="\n"&&(t+=1)):z&&(e.push(function(a){return function(){return a}}(z)),l+=z.length,z="");switch(y){case"!":break;case"":case"&":case"{":f=function(a,b){return function(c){var d,e;return(d=(e=C(a,c))!=null?e:"")instanceof Function&&(d=B.apply(null,[this,F(""+d())].concat(Q.call(arguments)))),b||(d=this.escape(""+d)),""+d}},e.push(f(v,y));break;case">":h=function(a,b){return function(c,d){var e;return e=d(a).toString(),b&&(e=e.replace(/^(?=.)/gm,b)),B.apply(null,[this,F(e)].concat(Q.call(arguments)))}},e.push(h(v,z));break;case"#":case"^":u={name:v,start:t,error:s(w.lastIndex,"Unclosed section '"+v+"'!")},G=F(a,b,u),x=G[0],t=G[1],u["#"]=i=function(a,b,c){return function(d){var e,f,g,h;return h=C(a,d)||[],x=h instanceof Function?h(c):c,h instanceof Array||(h=[h]),e=F(x||"",b),d.push(h),f=function(){var a,b,c;c=[];for(a=0,b=h.length;a<b;a++)g=h[a],d[d.length-1]=g,c.push(B.apply(null,[this,e].concat(Q.call(arguments))));return c}.apply(this,arguments),d.pop(),f.join("")}},u["^"]=g=function(a,b,c){return function(d){var e;return e=C(a,d)||[],e instanceof Array||(e=[1]),e=e.length===0?F(c,b):[],B.apply(null,[this,e].concat(Q.call(arguments)))}},e.push(u[y](v,b,x));break;case"/":c==null?n="End Section tag '"+v+"' found, but not in section!":v!==(r=c.name)&&(n="End Section tag closes '"+v+"'; expected '"+r+"'!");if(n)throw s(w.lastIndex,n);return a=a.slice(c.start,l+1||9e9),j[a]=e,[a,t];case"=":(b=v.split(/\s+/)).length!==2&&(n="Set Delimiters tags should have two and only two values!");if(n)throw s(w.lastIndex,n);o=/[-[\]{}()*+?.,\\^$|#]/g,b=function(){var a,c,d;d=[];for(a=0,c=b.length;a<c;a++)m=b[a],d.push(m.replace(o,"\\$&"));return d}(),w=d();break;default:throw s(w.lastIndex,"Unknown tag type -- "+y)}w.lastIndex=t!=null?t:a.length}if(c!=null)throw c.error;return a.length!==t&&e.push(function(){return a.slice(t)}),j[a]=e},D={VERSION:"1.2.0",helpers:[],partials:null,escape:function(a){var b;return b={"&":"amp",'"':"quot","<":"lt",">":"gt"},a.replace(/[&"<>]/g,function(a){return"&"+b[a]+";"})},render:function(a,b,c){var d;return c==null&&(c=null),(c||(c=this.partials||{}))instanceof Function||(c=function(a){return function(b){if(b in a)return C(b,[a]);throw"Unknown partial '"+b+"'!"}}(c)),d=this.helpers instanceof Array?this.helpers:[this.helpers],B(this,F(a),d.concat([b]),c)}},this.__apptools_preinit!=null?(this.__apptools_preinit.abstract_base_classes=[],this.__apptools_preinit.deferred_core_modules=[],this.__apptools_preinit.abstract_feature_interfaces=[],this.__apptools_preinit.deferred_library_integrations=[]):this.__apptools_preinit={abstract_base_classes:[],deferred_core_modules:[],abstract_feature_interfaces:[],deferred_library_integrations:[]},k=function(){function a(){}return a}(),this.__apptools_preinit.abstract_base_classes.push(k),t=function(){function a(){}return a}(),this.__apptools_preinit.abstract_base_classes.push(t),r=function(){function a(){}return a}(),this.__apptools_preinit.abstract_base_classes.push(r),q=function(a){function b(a,b,c){this.module=a,this.message=b,this.context=c}return S(b,a),b.prototype.toString=function(){return"["+this.module+"] CoreException: "+this.message},b}(Error),this.__apptools_preinit.abstract_base_classes.push(q),a=function(a){function b(){b.__super__.constructor.apply(this,arguments)}return S(b,a),b.prototype.toString=function(){return"["+this.module+"] AppException: "+this.message},b}(q),d=function(a){function b(){b.__super__.constructor.apply(this,arguments)}return S(b,a),b.prototype.toString=function(){return"["+this.module+"] AppToolsException: "+this.message},b}(q),this.__apptools_preinit.abstract_base_classes.push(a),this.__apptools_preinit.abstract_base_classes.push(d),this.Backbone!=null?(h=function(a){function b(){b.__super__.constructor.apply(this,arguments)}return S(b,a),b}(Backbone.View),f=function(a){function b(){b.__super__.constructor.apply(this,arguments)}return S(b,a),b}(Backbone.Model),g=function(a){function b(){b.__super__.constructor.apply(this,arguments)}return S(b,a),b}(Backbone.Router),c=function(a){function b(){b.__super__.constructor.apply(this,arguments)}return S(b,a),b}(Backbone.Collection)):(h=function(){function a(){}return a}(),f=function(){function a(){}return a}(),g=function(){function a(){}return a}(),c=function(){function a(){}return a}()),this.__apptools_preinit.abstract_base_classes.push(h),this.__apptools_preinit.abstract_base_classes.push(f),this.__apptools_preinit.abstract_base_classes.push(g),this.__apptools_preinit.abstract_base_classes.push(c),n=function(a){function b(a,b){var c=this;this.config={},this.environment={},this.performance={},this.debug={logging:!0,eventlog:!0,verbose:!0,serverside:!1},this.setDebug=function(a){return c.debug=a,c._sendLog("[CoreDev] Debug has been set.",c.debug)},this._sendLog=function(){var a;return a=1<=arguments.length?Q.call(arguments,0):[],console.log.apply(console,a)},this.log=function(){var a,b,d;d=arguments[0],b=arguments[1],a=3<=arguments.length?Q.call(arguments,2):[],a==null&&(a="{no context}"),c.debug.logging===!0&&c._sendLog.apply(c,["["+d+"] INFO: "+b].concat(Q.call(a)))},this.warning=this.warn=function(){var a,b,d;d=arguments[0],b=arguments[1],a=3<=arguments.length?Q.call(arguments,2):[],a==null&&(a="{no context}"),c.debug.logging===!0&&c._sendLog.apply(c,["["+d+"] WARNING: "+b].concat(Q.call(a)))},this.error=function(){var a,b,d;d=arguments[0],b=arguments[1],a=3<=arguments.length?Q.call(arguments,2):[],c.debug.logging===!0&&c._sendLog.apply(c,["["+d+"] ERROR: "+b].concat(Q.call(a)))},this.verbose=function(){var a,b,d;d=arguments[0],b=arguments[1],a=3<=arguments.length?Q.call(arguments,2):[],c.debug.verbose===!0&&c._sendLog.apply(c,["["+d+"] DEBUG: "+b].concat(Q.call(a)))},this.exception=this.critical=function(){var a,d,e,f;throw f=arguments[0],e=arguments[1],d=arguments[2],a=4<=arguments.length?Q.call(arguments,3):[],d==null&&(d=b.AppToolsException),c._sendLog("A critical error or unhandled exception occurred."),c._sendLog.apply(c,["["+f+"] CRITICAL: "+e].concat(Q.call(a))),new d(f,e,a)}}return S(b,a),b.mount="dev",b.events=[],b}(k),this.__apptools_preinit.abstract_base_classes.push(n),s=function(a){function b(a,b){}return S(b,a),b.mount="model",b.events=[],b}(k),this.__apptools_preinit.abstract_base_classes.push(s),p=function(a){function b(a,b){var c=this;this.registry=[],this.callchain={},this.history=[],this.fire=this.trigger=function(){var b,d,e,f,g,h,i,j,k,l,m,n,o,p;f=arguments[0],b=2<=arguments.length?Q.call(arguments,1):[],a.dev.verbose("Events","Triggered event:",f,b,c.callchain[f]);if(T.call(c.registry,f)>=0){i=0,h=0,g=[],k=[],k.push(f),p=c.callchain[f].hooks;for(l=0,n=p.length;l<n;l++){e=p[l];try{if(e.once===!0&&e.has_run===!0)continue;e.bridge!=null==0?(j=e.fn.apply(e,b),i++,c.history.push({event:f,callback:e,args:b,result:j}),e.has_run=!0):e.bridge===!0&&g.push({event:e.event,args:b})}catch(q){h++,c.history.push({event:f,callback:e,args:b,error:q})}}for(m=0,o=g.length;m<o;m++)d=g[m],k.push(d.event),c.trigger.apply(c,[d.event].concat(Q.call(d.args)));return{events:k,executed:i,errors:h}}return!1},this.create=this.register=function(b){var d,e,f;b instanceof Array||(b=[b]);for(e=0,f=b.length;e<f;e++)d=b[e],c.registry.push.apply(c.registry,b),c.callchain[d]={hooks:[]};return a.dev.verbose("Events","Registered events:",{count:b.length,events:b}),!0},this.on=this.upon=this.when=this.hook=function(b,d,e){return e==null&&(e=!1),T.call(c.registry,b)<0&&(a.dev.warning("Events",""),c.register(b)),c.callchain[b].hooks.push({fn:d,once:e,has_run:!1,bridge:!1}),a.dev.verbose("Events","Hook registered on event.",b),!0},this.delegate=this.bridge=function(b,d){var e,f,g,h,i;typeof d=="string"&&(d=[d]),typeof b=="string"&&(b=[b]),i=[];for(g=0,h=b.length;g<h;g++)e=b[g],i.push(function(){var b,c,g;g=[];for(b=0,c=d.length;b<c;b++)f=d[b],a.dev.verbose("Events","Bridging events:",e,"->",f),this.callchain[e]==null&&(a.dev.warn("Events","Bridging from undefined source event:",e),this.register(e)),g.push(this.callchain[e].hooks.push({event:f,bridge:!0}));return g}.call(c));return i}}return S(b,a),b.mount="events",b.events=[],b}(k),this.__apptools_preinit.abstract_base_classes.push(p),m=function(a){function b(a,b){this._data={},this.platform={},this.capabilities={},a.lib.modernizr!=null&&(this.capabilities=a.lib.modernizr),this.capabilities.simple={},this._data={browsers:[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:b.opera,identity:"Opera"},{string:navigator.vendor,subString:"iCab",identity:"iCab"},{string:navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.vendor,subString:"Camino",identity:"Camino"},{string:navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}],os:[{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac"},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone/iPod"},{string:navigator.platform,subString:"Linux",identity:"Linux"}]}}return S(b,a),b.mount="agent",b.events=["UA_DISCOVER"],b.prototype._makeMatch=function(a){var b,c,d,e,f;for(e=0,f=a.length;e<f;e++){d=a[e],c=d.string,b=d.prop,this._data.versionSearchString=d.versionSearch||d.identity;if(c!==null){if(d.string.indexOf(d.subString)!==-1)return d.identity}else if(b)return d.identity}},b.prototype._makeVersion=function(a){var b;b=a.indexOf(this._data.versionSearchString);if(b!==-1)return parseFloat(a.substring(b+this._data.versionSearchString.length+1))},b.prototype.discover=function(){var a,b,c,d,e;a=this._makeMatch(this._data.browsers)||"unknown",e=this._makeVersion(navigator.userAgent)||this._makeVersion(navigator.appVersion)||"unknown",c=this._makeMatch(this._data.os)||"unknown";if(a==="iPod/iPhone"||a==="Android")d="mobile",b=!1;this.platform={os:c,type:d,vendor:navigator.vendor,product:navigator.product,browser:a,version:e,flags:{online:navigator.onLine||!0,mobile:b,webkit:$.browser.webkit,msie:$.browser.msie,opera:$.browser.opera,mozilla:$.browser.mozilla}},this.capabilities.simple.cookies=navigator.cookieEnabled;if(window.jQuery!=null)return this.capabilities.simple.ajax=$.support.ajax},b}(k),this.__apptools_preinit.abstract_base_classes.push(m),o=function(a){function b(a,b){var c=this;this.state={opened:!1,receiving:!1,error:!1,history:{errors:[],received:[]},pending:{},complete:{}},this.init=function(){return c.state.opened=!0,a.dev.verbose("Dispatch","Dispatch startup signal received.")},this.expect=function(b,d,e){return c.state.pending[b]={request:d,callbacks:callbacks,xhr:e},a.dev.verbose("Dispatch","Received EXPECT signal.",b,d,callbacks,e)},this.receive=function(b){var d,e,f,g,h;try{e=JSON.parse(b.data)}catch(i){e=b.data}return a.dev.verbose("Dispatch","Parsed async message.",e),c.state.history.received.push(b),e.status==="ok"?(a.dev.verbose("Dispatch","Triggering deferred success callback."),c.state.complete[e.id]=c.state.pending[e.id],c.state.complete[e.id].response=e,delete c.state.pending[e.id],a.dev.log("RPC","Success",b.data,e.status,c.state.complete[e.id].xhr),a.api.rpc.lastResponse=b.data,a.api.rpc.history[e.id].xhr=c.state.complete[e.id].xhr,a.api.rpc.history[e.id].status=e.status,a.api.rpc.history[e.id].response=b.data,d={xhr:c.state.complete[e.id].xhr,status:e.status,data:b.data},a.events.trigger("RPC_SUCCESS",d),typeof (f=c.state.complete[e.id].callbacks).success=="function"?f.success(e.response.content):void 0):e.status==="notify"?(a.dev.verbose("Dispatch","Received NOTIFY signal."),typeof (g=c.state.pending[e.id].callbacks).notify=="function"?g.notify(e.response.content):void 0):(a.dev.error("Dispatch","Userland deferred task error. Calling error callback.",e),typeof (h=c.state.pending[e.id].callbacks).error=="function"?h.error(e.content):void 0)},this.error=function(b){return c.state.error=!0,c.history.errors.push(b),a.dev.error("Dispatch","Dispatch error state triggered.",b)},this.close=function(){return c.state.opened=!1,c.state.receiving=!1,a.dev.verbose("Dispatch","Dispatch shutdown signal received.")}}return S(b,a),b.mount="dispatch",b.events=[],b}(k),this.__apptools_preinit.abstract_base_classes.push(o),x=function(a){function b(a,b){var c=this;this._state={runtime:{index:{key_read_tally:{},key_write_tally:{},local_by_key:{},local_by_kind:{}},count:{total_keys:0,by_collection:[],by_kind:[]},data:{}},config:{autoload:!1,autosync:{enabled:!1,interval:120},adapters:{},obfuscate:!1,local_only:!1,callbacks:{ready:null,sync:null}},supervisor:{},cachebridge:{},model_kind_map:{},collection_kind_map:{}},this.internal={check_support:function(a){},bootstrap:function(a){},provision_collection:function(a,b,c){}},this.get=function(){},this.list=function(){},this.count=function(){},this.put=function(){},this.query=function(){},this["delete"]=function(){},this.sync=function(){},this._init=function(){return a.dev.verbose("Storage","Storage support is currently stubbed."),a.events.trigger("STORAGE_INIT"),a.events.trigger("STORAGE_READY")},a.events.bridge(["STORAGE_READ","STORAGE_WRITE","STORAGE_DELETE"],"STORAGE_ACTIVITY"),a.events.bridge(["COLLECTION_CREATE","COLLECTION_UPDATE","COLLECTION_DESTROY","COLLECTION_SYNC","COLLECTION_SCAN"],"STORAGE_ACTIVITY")}return S(b,a),b.mount="storage",b.events=["STORAGE_INIT","STORAGE_READY","STORAGE_ERROR","STORAGE_ACTIVITY","STORAGE_READ","STORAGE_WRITE","STORAGE_DELETE","COLLECTION_SCAN","COLLECTION_CREATE","COLLECTION_DESTROY","COLLECTION_UPDATE","COLLECTION_SYNC"],b}(k),O=function(a){function b(){return}return S(b,a),b.methods=[],b["export"]="private",b}(r),this.__apptools_preinit.abstract_base_classes.push(O),this.__apptools_preinit.abstract_base_classes.push(x),this.__apptools_preinit.abstract_feature_interfaces.push({adapter:O,name:"storage"}),I=function(a){function b(a,b,c,d){var e,f,g,h;this.name=a,this.base_uri=b,this.methods=c,this.config=d;if(this.methods.length>0){h=this.methods;for(f=0,g=h.length;f<g;f++)e=h[f],this[e]=this._buildRPCMethod(e,b,d)}}return S(b,a),b.prototype._buildRPCMethod=function(a,b,c){var d,e,f=this;return d=this.name,e=function(b,c,e,f,g,h){return b==null&&(b={}),c==null&&(c=null),e==null&&(e=!1),f==null&&(f=!1),g==null&&(g={}),h==null&&(h={}),function(b,c,e,f,g){var i;return i=$.apptools.api.rpc.createRPCRequest({method:a,api:d,params:b||{},opts:g||{},async:e||!1,push:f||!1}),c!==null?i.fulfill(c,h):i}(b,c,e,f,g)},$.apptools.api.registerAPIMethod(d,a,b,c),e},b}(t),K=function(a){function b(a,b,c){this.params={},this.action=null,this.method=null,this.api=null,this.base_uri=null,this.envelope={id:null,opts:{},agent:{}},this.ajax={accepts:"application/json",async:!0,cache:!0,global:!0,http_method:"POST",crossDomain:!1,processData:!1,ifModified:!1,dataType:"json",push:!1,contentType:"application/json; charset=utf-8"},a!=null&&(this.envelope.id=a),b!=null&&(this.envelope.opts=b),c!=null&&(this.envelope.agent=c)}return S(b,a),b.prototype.fulfill=function(a,b){var c,d,e=this;return a==null&&(a={}),(a!=null?a.success:void 0)==null&&(d=function(a,b,c){return $.apptools.dev.log("RPC","RPC succeeded but had no success callback.",e,a,b,c)},a.success=d),(a!=null?a.failure:void 0)==null&&(c=function(a){return $.apptools.dev.error("RPC","RPC failed but had no failure callback.",e,a)},a.failure=c),$.apptools.api.rpc.fulfillRPCRequest(b,this,a)},b.prototype.setAsync=function(a){var b;return(b=this.ajax)!=null&&b.async==null&&(b.async=a),this},b.prototype.setPush=function(a){return a===!0&&(this.ajax.push=!0,this.envelope.opts.alt="socket",this.envelope.opts.token=$.apptools.push.state.config.token),this},b.prototype.setOpts=function(a){var b,c;return(b=this.envelope)!=null&&(b.opts=_.defaults(a,(c=this.envelope)!=null?c.opts:void 0)),this},b.prototype.setAgent=function(a){var b;return(b=this.envelope)!=null&&b.agent==null&&(b.agent=a),this},b.prototype.setAction=function(a){return this.action=a,this},b.prototype.setMethod=function(a){return this.method=a,this},b.prototype.setAPI=function(a){return this.api=a,this},b.prototype.setBaseURI=function(a){return this.base_uri=a,this},b.prototype.setParams=function(a){return this.params=a!=null?a:{},this},b.prototype.payload=function(){var a;return a={id:this.envelope.id,opts:this.envelope.opts,agent:this.envelope.agent,request:{params:this.params,method:this.method,api:this.api}},a},b}(t),L=function(a){function b(){var a;a=1<=arguments.length?Q.call(arguments,0):[],$.apptools.dev.verbose("RPC","RPCResponse is not yet implemented and is currently stubbed.");return}return S(b,a),b}(t),v=function(a){function c(a,c){var d,e,f,g=this;this.state={sockets:{token:"__NULL__",enabled:!1,status:"DISCONNECTED","default":null,default_host:((e=a.config)!=null?(f=e.rpc)!=null?f.socket_host:void 0:void 0)!=null||null}},this.base_rpc_uri=a.config.rpc.base_uri||"/_api/rpc",this.socket_host=a.config.rpc.socket_host||null,a.sys.libraries.resolve("jQuery")!==!1?d=$.ajaxSettings.xhr:d=new XMLHTTPRequest,this.internals={transports:{xhr:{factory:function(){var b;return b=d(),b&&typeof b.addEventListener=="function"&&b.addEventListener("progress",function(b){return a.events.trigger("RPC_PROGRESS",{event:b})},!1),b}},websocket:{factory:function(){var b,c,d,e,f,h;if(a.agent.capabilities.websockets==null)throw a.dev.error("RPC","Socket factory can't produce a socket because the client platform does not support WebSockets."),"SocketsNotSupported: The client platform does not have support for websockets.";if(((d=g.state.sockets)!=null?d.enabled:void 0)!=null==1)return((e=g.state.sockets)!=null?e["default"]:void 0)!=null===null&&((f=g.state.sockets)!=null?(h=f.open)!=null?h.length:void 0:void 0)===0&&(c=new a.push.socket.establish,g.state.sockets.enabled=!0,g.state.sockets["default"]=c,g.state.sockets.status="CONNECTED"),b={},b}}},config:{headers:{"X-ServiceClient":["AppToolsJS/",[b.version.major.toString(),b.version.minor.toString(),b.version.micro.toString(),b.version.build.toString()].join("."),"-",b.version.release.toString()].join(""),"X-ServiceTransport":"AppTools/JSONRPC"}}},a.sys.libraries.resolve("jQuery")!==!1&&$.ajaxSetup({global:!0,xhr:function(){return g.internals.transports.xhr.factory()},headers:this.internals.config.headers}),this.rpc={lastRequest:null,lastFailure:null,lastResponse:null,history:{},action_prefix:null,alt_push_response:!1,used_ids:[],factory:function(b,c,d,e){return a.api[b]=new I(b,c,d,e)},_assembleRPCURL:function(a,b,c,d){if(b==null&&d==null)throw"[RPC] Error: Must specify either an API or base URI to generate an RPC endpoint.";return b!=null?d!=null?d=d+"/"+b:d=g.base_rpc_uri+"/"+b:d==null&&(d=g.base_rpc_uri),c!==null?[c+d,a].join("."):[d,a].join(".")},provisionRequestID:function(){var a;return g.rpc.used_ids.length>0?(a=Math.max.apply(g,g.rpc.used_ids)+1,g.rpc.used_ids.push(a),a):(g.rpc.used_ids.push(1),1)},decodeRPCResponse:function(a,b,c,d,e){return d(a,b)},createRPCRequest:function(b){var c;return c=new K(g.rpc.provisionRequestID()),b.api!=null&&c.setAPI(b.api),b.method!=null&&c.setMethod(b.method),b.agent!=null&&c.setAgent(b.agent),b.opts!=null&&c.setOpts(b.opts),b.base_uri!=null&&c.setBaseURI(b.base_uri),b.params!=null&&c.setParams(b.params),b.async!=null&&c.setAsync(b.async),b.push!=null?c.setPush(b.push):c.setPush(g.rpc.alt_push_response),a.dev.verbose("RPC","New Request",c,b),c.setAction(g.rpc._assembleRPCURL(c.method,c.api,g.rpc.action_prefix,g.base_rpc_uri)),c},fulfillRPCRequest:function(b,c,d,e){var f;e==null&&(e="xhr"),a.dev.verbose("RPC","Fulfill",b,c,d),g.rpc.lastRequest=c,g.rpc.history[c.envelope.id]={request:c,config:b,callbacks:d};if(c.action===null){if(c.method===null)throw"[RPC] Error: Request must specify at least an action or method.";if(c.base_uri===null){if(c.api===null)throw"[RPC] Error: Request must have an API or explicity defined BASE_URI.";c.action=g.rpc._assembleRPCURL(c.method,c.api,g.rpc.action_prefix)}else c.action=g.rpc._assembleRPCURL(c.method,null,g.rpc.action_prefix,c.base_uri)}if(c.action===null||c.action===void 0)throw"[RPC] Error: Could not determine RPC action.";return f={config:b,request:c,callbacks:d},a.events.trigger("RPC_FULFILL",f),function(a,b,c){var d,e,g,h,i=this;h={resourceId:b.api+"."+b.method,url:b.action,data:JSON.stringify(b.payload()),async:b.ajax.async,global:b.ajax.global,type:b.ajax.http_method||"POST",accepts:b.ajax.accepts||"application/json",crossDomain:b.ajax.crossDomain,dataType:b.ajax.dataType,processData:!1,ifModified:b.ajax.ifModified,contentType:b.ajax.contentType,beforeSend:function(d,e){return a.api.rpc.history[b.envelope.id].xhr=d,c!=null&&typeof c.status=="function"&&c.status("beforeSend"),d},error:function(d,e,g){return c!=null&&typeof c.status=="function"&&c.status("error"),a.dev.error("RPC","Error: ",{error:g,status:e,xhr:d}),a.api.rpc.lastFailure=g,a.api.rpc.history[b.envelope.id].xhr=d,a.api.rpc.history[b.envelope.id].status=e,a.api.rpc.history[b.envelope.id].failure=g,f={xhr:d,status:e,error:g},a.events.trigger("RPC_ERROR",f),a.events.trigger("RPC_COMPLETE",f),c!=null?typeof c.failure=="function"?c.failure(g):void 0:void 0},success:function(d,e,g){return d.status==="ok"?(c!=null&&typeof c.status=="function"&&c.status("success"),a.dev.log("RPC","Success",d,e,g),a.api.rpc.lastResponse=d,a.api.rpc.history[b.envelope.id].xhr=g,a.api.rpc.history[b.envelope.id].status=e,a.api.rpc.history[b.envelope.id].response=d,f={xhr:g,status:e,data:d},a.events.trigger("RPC_SUCCESS",f),a.events.trigger("RPC_COMPLETE",f),c!=null?typeof c.success=="function"?c.success(d.response.content,d.response.type,d):void 0:void 0):d.status==="wait"?(c!=null&&typeof c.status=="function"&&c.status("wait"),a.dev.log("RPC","PushWait",d,e,g),f={xhr:g,status:e,data:d},c!=null&&typeof c.wait=="function"&&c.wait(d,e,g),a.push.internal.expect(b.envelope.id,b,g)):d.status==="fail"?(c!=null&&typeof c.status=="function"&&c.status("error"),a.dev.error("RPC","Error: ",{error:d,status:e,xhr:g}),a.api.rpc.lastFailure=d,a.api.rpc.history[b.envelope.id].xhr=g,a.api.rpc.history[b.envelope.id].status=e,a.api.rpc.history[b.envelope.id].failure=d,f={xhr:g,status:e,error:d},a.events.trigger("RPC_ERROR",f),a.events.trigger("RPC_COMPLETE",f),c!=null?typeof c.failure=="function"?c.failure(d):void 0:void 0):c!=null?typeof c.success=="function"?c.success(d.response.content,d.response.type,d):void 0:void 0},statusCode:{404:function(){return a.dev.error("RPC","HTTP/404","Could not resolve RPC action URI."),a.events.trigger("RPC_ERROR",{message:"RPC 404: Could not resolve RPC action URI.",code:404})},403:function(){return a.dev.error("RPC","HTTP/403","Not authorized to access the specified endpoint."),a.events.trigger("RPC_ERROR",{message:"RPC 403: Not authorized to access the specified endpoint.",code:403})},500:function(){return a.dev.error("RPC","HTTP/500","Internal server error."),a.events.trigger("RPC_ERROR",{message:"RPC 500: Woops! Something went wrong. Please try again.",code:500})}}},d=a.sys.drivers.resolve("transport");if(d.name==="amplify")a.dev.verbose("RPC","Fulfilling with AmplifyJS transport adapter."),g=d.driver.request,e=g(h);else{if(d.name!=="jquery")throw a.dev.error("RPC","Native RPC adapter is currently stubbed."),"[RPC]: No valid AJAX transport adapter found.";a.dev.verbose("RPC","Fulfilling with jQuery AJAX transport adapter.",h),e=jQuery.ajax(h.url,h)}return a.dev.verbose("RPC","Resulting XHR: ",e)}(a,c,d),{id:c.envelope.id,request:c}}},this.ext=null,this.registerAPIMethod=function(b,c,d,e){var f,h,i,j;if(a!=null?(j=a.sys)!=null?j.drivers:void 0:void 0){f=a.sys.drivers.resolve("transport","amplify");if(f!==!1)return a.dev.log("RPCAPI",'Registering request procedure "'+b+"."+c+'" with AmplifyJS.'),i=b+"."+c,h={accepts:"application/json",type:"POST",dataType:"json",contentType:"application/json",url:g.rpc._assembleRPCURL(c,b,null,d),decoder:g.rpc.decodeRPCResponse},e.caching!=null?(e.caching===!0&&(h.caching="persist"),f.request.define(i,"ajax",h)):f.request.define(i,"ajax",h)}}}return S(c,a),c.mount="api",c.events=["RPC_CREATE","RPC_FULFILL","RPC_SUCCESS","RPC_ERROR","RPC_COMPLETE","RPC_PROGRESS"],c}(k),J=function(a){function b(){return}return S(b,a),b.methods=[],b["export"]="private",b}(r),this.__apptools_preinit.abstract_base_classes.push(I),this.__apptools_preinit.abstract_base_classes.push(J),this.__apptools_preinit.abstract_base_classes.push(v),this.__apptools_preinit.abstract_base_classes.push(K),this.__apptools_preinit.abstract_base_classes.push(L),this.__apptools_preinit.abstract_feature_interfaces.push({adapter:J,name:"transport"}),y=function(a){function b(a,b){this.current_user=null}return S(b,a),b.mount="user",b.events=["SET_USER_INFO"],b.prototype.setUserInfo=function(a){return this.current_user=a.current_user||null,$.apptools.dev.log("UserAPI","Set server-injected userinfo: ",this.current_user),$.apptools.events.trigger("SET_USER_INFO",this.current_user)},b}(k),this.__apptools_preinit.abstract_base_classes.push(y),u=function(a){function b(a,b){var c=this;this.state={ready:!1,status:"init",transport:{sockets:[],channel:null},callbacks:{open:null,expect:null,activity:null,error:null,close:null},config:{token:null}},a.events.bridge(["PUSH_READY","PUSH_SOCKET_ESTABLISH","PUSH_SOCKET_ERROR","PUSH_SOCKET_OPEN","PUSH_SOCKET_CLOSE"],"PUSH_STATE_CHANGE"),a.events.hook("PUSH_SOCKET_OPEN",function(){var b;return b=1<=arguments.length?Q.call(arguments,0):[],a.api.rpc.alt_push_response=!0}),a.events.hook("PUSH_SOCKET_CLOSE",function(){var b;return b=1<=arguments.length?Q.call(arguments,0):[],a.api.rpc.alt_push_response=!1}),this.events={on_open:function(b){if(c.state.transport.sockets.length=0)c.state.status="ready";return a.events.trigger("PUSH_SOCKET_OPEN",c.state),a.dev.verbose("PushSocket","Message transport opened.")},on_message:function(b,d){var e;return c.state.status="receiving",a.dev.verbose("PushSocket","Message received.",d),a.events.trigger("PUSH_SOCKET_ACTIVITY",c.state),typeof (e=c.state.callbacks).activity=="function"&&e.activity(d),a.events.trigger("PUSH_SOCKET_ACTIVITY_FINISH",c.state)},on_error:function(b,d){return c.state.status="error",a.dev.error("PushSocket","Message transport error.",d),a.events.trigger("PUSH_SOCKET_ERROR",c.state)},on_close:function(b){return c.state.ready=!1,c.state.status="close",a.dev.verbose("PushSocket","Message transport closed."),a.events.trigger("PUSH_SOCKET_CLOSE",c.state)}},this.internal={open_channel:function(b){return a.events.trigger("PUSH_INIT",{token:b,type:"channel"}),c.state.config.token=b,c.state.transport.channel=new goog.appengine.Channel(c.state.config.token),c.internal._add_socket(c.state.transport.channel)},open_websocket:function(b,d){return a.events.trigger("PUSH_INIT",{token:b,server:d,type:"websocket"}),a.dev.log("Push","WARNING: WebSockets support is currently experimental."),c.internal._add_socket(c.state.transport.socket)},_add_socket:function(b,d){var e;return e=b.open(),c.state.transport.sockets.push(e),a.events.trigger("PUSH_SOCKET_ESTABLISH",e),e.onopen=function(){var a,b;return a=1<=arguments.length?Q.call(arguments,0):[],(b=c.events).on_open.apply(b,[e].concat(Q.call(a)))},e.onmessage=function(){var a,b;return a=1<=arguments.length?Q.call(arguments,0):[],(b=c.events).on_message.apply(b,[e].concat(Q.call(a)))},e.onerror=function(){var a,b;return a=1<=arguments.length?Q.call(arguments,0):[],(b=c.events).on_error.apply(b,[e].concat(Q.call(a)))},e.onclose=function(){var a,b;return a=1<=arguments.length?Q.call(arguments,0):[],(b=c.events).on_close.apply(b,[e].concat(Q.call(a)))},c.internal},expect:function(a,b,d){var e,f;return(e=c.state)!=null&&(f=e.callbacks)!=null&&typeof f.expect=="function"&&f.expect(a,b,d),c.internal}},this.channel={establish:function(a){return c.internal.open_channel(a)}},this.socket={establish:function(b,d){return d==null&&(d=null),c.internal.open_websocket(b,d||a.config.sockets.host)}},this.listen=function(a){return c.state.callbacks=_.defaults(a,c.state.callbacks),c.state.ready=!0,c.internal}}return S(b,a),b.mount="push",b.events=["PUSH_INIT","PUSH_READY","PUSH_STATE_CHANGE","PUSH_SOCKET_OPEN","PUSH_SOCKET_ESTABLISH","PUSH_SOCKET_ACTIVITY","PUSH_SOCKET_ACTIVITY_FINISH","PUSH_SOCKET_ERROR","PUSH_SOCKET_CLOSE"],b}(k),G=function(a){function b(){return}return S(b,a),b.methods=[],b["export"]="private",b}(r),this.__apptools_preinit.abstract_base_classes.push(G),this.__apptools_preinit.abstract_base_classes.push(u),this.__apptools_preinit.abstract_feature_interfaces.push({adapter:G,name:"transport"}),w=function(a){function b(a,b){return}return S(b,a),b.mount="render",b.events=["ADD_TEMPLATE","RENDER_TEMPLATE"],b["export"]="private",b.prototype._init=function(){},b}(k),M=function(a){function b(){return}return S(b,a),b["export"]="private",b.methods=["render","register_template"],b}(r),H=function(a){function b(){return}return S(b,a),b["export"]="private",b.methods=["element_by_id","elements_by_class"],b}(r),this.__apptools_preinit.abstract_base_classes.push(H),this.__apptools_preinit.abstract_base_classes.push(M),this.__apptools_preinit.abstract_base_classes.push(w),this.__apptools_preinit.abstract_feature_interfaces.push({adapter:M,name:"render"}),A=function(a){function b(){b.__super__.constructor.apply(this,arguments)}return S(b,a),b.mount="widget",b.events=[],b.prototype._init=function(a){a.sys.state.add_flag("widgets"),a.dev.verbose("CoreWidget","Widget functionality is currently stubbed.")},b}(k),z=function(a){function b(){b.__super__.constructor.apply(this,arguments)}return S(b,a),b}(t),this.__apptools_preinit!=null?(this.__apptools_preinit.abstract_base_classes==null&&(this.__apptools_preinit.abstract_base_classes=[]),this.__apptools_preinit.deferred_core_modules==null&&(this.__apptools_preinit.deferred_core_modules=[])):this.__apptools_preinit={abstract_base_classes:[],deferred_core_modules:[]},this.__apptools_preinit.abstract_base_classes.push(z),this.__apptools_preinit.abstract_base_classes.push(A),this.__apptools_preinit.deferred_core_modules.push({module:A}),l=function(a){function b(){this._init=U(this
._init,this),b.__super__.constructor.apply(this,arguments)}return S(b,a),b.mount="admin",b.events=[],b.prototype._init=function(a){a.sys.state.add_flag("admin"),a.dev.log("AdminAPI","NOTICE: Admin APIs are enabled.")},b}(k),this.__apptools_preinit!=null?(this.__apptools_preinit.abstract_base_classes==null&&(this.__apptools_preinit.abstract_base_classes=[]),this.__apptools_preinit.deferred_core_modules==null&&(this.__apptools_preinit.deferred_core_modules=[])):this.__apptools_preinit={abstract_base_classes:[],deferred_core_modules:[]},this.__apptools_preinit.abstract_base_classes.push(l),this.__apptools_preinit.deferred_core_modules.push({module:l}),i=function(a){function b(a,b){a.dev.verbose("BlogManager","AppToolsXMS BlogManager is currently stubbed.")}return S(b,a),b.mount="blog",b.events=[],b}(l),this.__apptools_preinit.abstract_base_classes.push(i),this.__apptools_preinit.deferred_core_modules.push({module:i,"package":"admin"}),E=function(a){function b(a,b,c){a.dev.verbose("PageManager","AppToolsXMS PageManager is currently stubbed.")}return S(b,a),b.mount="page",b.events=["PAGE_EDIT","PAGE_SAVE","PAGE_META_SAVE"],b}(l),this.__apptools_preinit.abstract_base_classes.push(E),this.__apptools_preinit.deferred_core_modules.push({module:E,"package":"admin"}),N=function(a){function b(a,b,c){a.dev.verbose("SiteManager","AppToolsXMS SiteManager is currently stubbed.")}return S(b,a),b.mount="site",b.events=["SITE_EDIT","SITE_SAVE","SITE_META_SAVE"],b}(l),this.__apptools_preinit.abstract_base_classes.push(N),this.__apptools_preinit.deferred_core_modules.push({module:N,"package":"admin"}),j=function(a){function b(a,b,c){var d,f,g,h,i,j,k=this;f=!1,i={},h={},d=0,g={panel:{commands:{undo:function(){return document.execCommand("undo")},redo:function(){return document.execCommand("redo")},cut:function(){return document.execCommand("cut")},paste:function(){return document.execCommand("paste")},table:function(){return document.execCommand("enableInlineTableEditing")},resize:function(){return document.execCommand("enableObjectResizing")},clip:null,b:function(){return document.execCommand("bold")},u:function(){return document.execCommand("underline")},i:function(){return document.execCommand("italic")},clear:function(){return document.execCommand("removeFormat")},h1:function(){var a;return a=document.selection?document.selection():c.getSelection(),document.execCommand("insertHTML",!1,'<h1 class="h1">'+String(a)+"</h1>")},h2:function(){var a;return a=document.selection?document.selection():c.getSelection(),document.execCommand("insertHTML",!1,'<h2 class="h2">'+String(a)+"</h2>")},h3:function(){var a;return a=document.selection?document.selection():c.getSelection(),document.execCommand("insertHTML",!1,'<h3 class="h3">'+String(a)+"</h3>")},fontColor:function(){var a,b;return b=document.selection?document.selection():c.getSelection(),a=prompt("Please enter a hexidecimal color value (i.e. #ffffff)"),a=a[0]==="#"?a:"#"+a,document.execCommand("insertHTML",!1,'<span style="color:'+a+';">'+b+"</span>")},fontSize:function(){var a,b;return b=document.selection?document.selection():c.getSelection(),a=prompt("Please enter desired point size (i.e. 10)"),document.execCommand("insertHTML",!1,'<span style="font-size:'+a+'pt;">'+b+"</span>")},fontFace:null,l:function(){return document.execCommand("justifyLeft")},r:function(){return document.execCommand("justifyRight")},c:function(){return document.execCommand("justifyCenter")},"in":function(){return document.execCommand("indent")},out:function(){return document.execCommand("outdent")},bullet:function(){return document.execCommand("insertUnorderedList")},number:function(){return document.execCommand("insertOrderedList")},indentSpecial:null,lineSpacing:null,link:function(){var a,b;return b=document.selection?document.selection():c.getSelection(),util.is(b)||(b=prompt("What link text do you want to display?")),a=prompt("What URL do you want to link to?"),document.execCommand("insertHTML",!1,'<a href="'+a+'">'+b+"</a>")},image:null,video:null},panel_html:['<div id="CMS_wrap">','<div id="CMS_panel" class="fixed panel" style="opacity: 0;">','<div id="CMS_frame" class="nowrap">','<div class="cms_pane" id="buttons">','<div class="cms_subpane">','<h1 class="cms_sp">editing</h1>',"<p>",'<button id="cms_undo" value="undo">undo</button>','<button id="cms_redo" value="redo">redo</button>','<button id="cms_cut" value="cut">cut</button>','<button id="cms_paste" value="paste">paste</button>',"</p>","</div>","<hr/>",'<div class="cms_subpane">','<h1 class="cms_sp">typography</h1>',"<p>",'<select id="cms_headers" class="cms">','<option id="cms_h1" class="h1">Heading 1</option>','<option id="cms_h2" class="h2">Heading 2</option>','<option id="cms_h3" class="h3">Heading 3</option>',"</select>",'<button id="cms_b" value="bold">B</button>','<button id="cms_u" value="underline">U</button>','<button id="cms_i" value="italic">I</button>','<button id="cms_clear" value="clear formatting">clear</button>','<button id="cms_fontColor" value="font color">font color</button>','<button id="cms_fontSize" value="font size">font size</button>',"</p>","</div>","<hr/>",'<div class="cms_subpane">','<h1 class="cms_sp">alignment</h1>','<p style="text-lign:center">','<button id="cms_l" value="left">left</button>','<button id="cms_c" value="center">center</button>','<button id="cms_r" value="right">right</button>',"<br>",'<button id="cms_in" value="indent">&raquo;</button>','<button id="cms_out" value="outdent">&laquo;</button>',"<br>",'<button id="cms_ul" value="unordered list">&lt;ul&gt;</button>','<button id="cms_ol" value="ordered list">&lt;ol&gt;</button>',"</p>","</div>","<hr/>",'<div class="cms_subpane">','<h1 class="cms_sp">interactive</h1>',"<p>",'<button id="cms_link" value="link">add link</button>',"</p>","</div>","</div>",'<div class="cms_pane" id="styles">','<div class="cms_subpane">','<h1 class="cms_sp">styles</h1>',"<p>MIDDLE</p>","</div>","</div>",'<div class="cms_pane" id="assets">','<div class="cms_subpane">','<h1 class="cms_sp">drop files here</h1>','<div id="upload_wrap">','<div id="upload" class="dragdrop">','<span class="center-text" id="up_content">+</span>',"</div>","</div>","</div>","<hr>",'<div class="cms_subpane">','<h1 class="cms_sp">uploaded assets</h1>',"<p>",'<button id="pop_assets_button" class="pop" name="assets" value="pop out this pane!">pop me out</button>',"</p>","</div>","</div>","</div>",'<div id="CMS_nav">','<a class="scroll" href="#buttons">buttons</a>','<a class="scroll" href="#styles">styles</a>','<a class="scroll" href="#assets">assets</a>',"</div>",'<div id="CMS_panel_footer">&copy; momentum labs 2012</div>',"</div>","</div>"].join("\n"),status_html:'<div class="fixed panel bigger" id="cms_edit_on" style="vertical-align: middle; left: -305px;top: 50px;width: 300px;text-align: right;padding-right: 10px;opacity: 0;"><span id="cms_span" style="color: #222;cursor: pointer">content editing <span style="color: green;font-weight: bold;">ON</span></span></div>',init:!1},scroller:{animation:{duration:500,easing:"easeInOutExpo",complete:null},axis:"horizontal",frame:"CMS_frame",init:!1},pop:{animation:{duration:500,easing:"easeInOutExpo",complete:null},position:{bottom:"60px",right:"60px"},init:!1},modal:{animation:{duration:400,easing:"easeInOutExpo",complete:null},initial:{width:"0px",height:"0px",top:c.innerHeight/2+"px",left:c.innerWidth/2+"px"},ratio:{x:.4,y:.4},html:['<div id="modal_wrap" style="opacity: 0;" class="modal_wrap">','<div id="modal" style="opacity: 0;" class="fixed modal">','<div id="modal_status"></div>','<div id="modal_content">',"*****","</div>",'<div id="modal_ui"><button id="mod-close">close</button></div>',"</div>","</div>"].join("\n"),content:'<span style="font-size: 25px;margin: 10px auto;color: #5f5f5f;font-weight:bold">hello, lightbox!</span>',rounded:!0,init:!1},overlay:'<div id="m-overlay" class="fixed" style="opacity: 0;"></div>',init:!1},this.config=$.extend(!0,{},g),this.util={bind:function(a,b,c){var d;return d={},d[b]=c,a.bind(d)},imgPreview:function(a){var b,c;return c=a.target.result,b=document.createElement("img"),b.classList.add("preview"),b.src=c,document.getElementById("upload").appendChild(b)},is:function(a){return $.inArray(a,[!1,null,NaN,void 0,0,{},[],"","false","False","null","NaN","undefined","0","none","None"])===-1?!0:!1},isID:function(a){return String(a).split("")[0]==="#"||document.getElementById(a)!==null?!0:!1},handleDrag:function(a){var b;e.preventDefault(),e.stopPropagation(),b=e.target;if(e.type==="dragenter")return $(b).addClass("hover");if(e.type!=="dragover")return $(b).removeClass("hover")},makeDragDrop:function(a){return a.addEventListener("dragenter",k.util.handleDrag,!1),a.addEventListener("dragexit",k.util.handleDrag,!1),a.addEventListener("dragleave",k.util.handleDrag,!1),a.addEventListener("dragover",k.util.handleDrag,!1),a.addEventListener("drop",k.uploadAsset,!1)},wrap:function(a){var b;return b=Array.prototype.slice.call(arguments,1),function(){return a.apply(this,b)}}},this.edit=function(a){var b,c,d;return c=$(a),d=c.offset(),b=c.attr("id"),console.log("Enabling inline editing of #"+b),a.contentEditable=!0,f=!0,i[b]=c.attr("style"),h[b]=c.html(),c.unbind("click"),$("body").append(k.config.overlay),$("#m-overlay").animate({opacity:.75},{duration:400,easing:"easeInOutExpo"}),c.css({"z-index":function(){var a;return a=900+Math.floor(Math.random()*81)}}),c.offset(d),k.util.isID("CMS_panel")||(k.panel.make(),k.panel.live()),$("#m-overlay").bind({click:k.util.wrap(k.save,a)})},this.save=function(a){var b,c,e,g,i;return e=$(a),b=e.attr("id"),g=e.html(),c=e.data("snippet-keyname")?e.data("snippet-keyname"):"default-key",i=k,a.contentEditable=!1,f=!1,k.panel.destroy(),k.util.bind(e,"click",k.util.wrap(k.edit,a)),k.util.isID("CMS_sync")||$("body").append('<div class="cms_message warn" id="CMS_sync" style="top: 50px;opacity: 0;"><div id="sync_loader" class="loader">syncing changes...</div></div>'),$("#m-overlay").animate({opacity:0},{duration:500,easing:"easeInOutExpo",complete:function(){$("#m-overlay").remove();if(g!==h[b])return $("#CMS_sync").animate({opacity:1},{duration:700,easing:"easeInOutExpo",complete:function(){return d++,i.sync({snippet_keyname:c,inner_html:g})}})}})},this.sync=function(a){var b;return b=k,$.apptools.dev.verbose("CMS","Initiating sync operation for snippet.",a),$.apptools.api.content.save_snippet(a).fulfill({success:function(){return d-1===0?($("#CMS_sync").html("changes saved!"),$("#CMS_sync").removeClass("warn").removeClass("error").addClass("yay"),setTimeout(function(){return $("#CMS_sync").animate({opacity:0},{duration:500,easing:"easeInOutExpo",complete:function(){return $("#CMS_sync").remove()}})},700),d--):d--},failure:function(c){return $("#CMS_sync").html("error syncing page."),$("#CMS_sync").removeClass("warn").addClass("error"),setTimeout(function(){return $("#CMS_sync").append('<br><a id="sync_retry" style="pointer: cursor;text-decoration: underline;">retry sync</a>'),b.util.bind($("#sync_retry"),"click",b.util.wrap(b.sync,a))},1500)}})},this.revert=function(a){var b;return b=$(a).data("snippet-keyname"),$.apptools.api.content.revert_snippet({snippet_keyname:b}).fulfill({success:function(){return $(_o).html(response.inner_html),$("body").append('div id="CMS_revert" class="cms_message yay" style="opacity: 0;">changes reverted!</div>'),$("#CMS_revert").animate({opacity:1},{duration:400,easing:"easeInOutExpo",complete:function(){return setTimeout(function(){return $("#CMS_revert").animate({opacity:0},{duration:500,easing:"easeInOutExpo",complete:function(){return $("#CMS_revert").remove()}})},700)}})},failure:function(a){return $("#CMS_revert").html("error reverting page."),$("#CMS_revert").removeClass("warn").addClass("error")}})},this.uploadAsset=function(a){var b,c,d,e,f,g;a.preventDefault(),a.stopPropagation(),$(a.target).removeClass("hover"),c=a.dataTransfer.files,d=function(a){var b;if(a.type.match(/image.*/))return b=new FileReader,b.onloadend=this.util.imgPreview,b.readAsDataURL(a)},g=[];for(e=0,f=c.length;e<f;e++)b=c[e],g.push(d(b));return g},this.placeAsset=function(a){},this.panel={make:function(){var a;return a=k.config.panel.panel_html,$("body").append(a),$("#CMS_panel").css({bottom:"0px"}),$("#CMS_wrap").css({opacity:1}),$("#CMS_panel").animate({bottom:"60px",opacity:1},{duration:500,easing:"easeInOutExpo"})},live:function(){var a,b,c,d,e,f;c=k.config.panel.commands,d=k.config.scroller.frame,f=document.getElementById("upload"),e=k,$(".scroll").each(function(){var a,b,c;return c=this,a=$(c),b=String(a.attr("href")).slice(1),a.attr("id","scr"+b),a.attr("href","javascript:void(0);"),$("#"+d).data("scroller",{axis:"horizontal"}),e.util.bind(a,"click",e.util.wrap(e.scroller.jump,b)),e.config.scroller.init=!0}),k.scroller.classify(d),$(".pop").each(function(){var a,b,c;return c=this,a=$(c),b=a.attr("name"),a.removeAttr("name"),a.data("pop",{target:b}),e.util.bind(a,"click",e.util.wrap(e.pop.pop,b)),e.config.pop.init=!0}),k.util.makeDragDrop(f);for(b in c)a=c[b],k.util.bind($("#cms_"+b),"click",a);return k.config.panel.init=!0},die:function(){var a,b,c,d;c=k.config.panel.commands,d=[];for(b in c)a=c[b],d.push($("#cms_"+b).unbind("click"));return d},destroy:function(){var a;$("#m-overlay").unbind(),a=!0;if(f===!1)return $("#CMS_panel").animate({opacity:0,bottom:"0px"},{duration:450,easing:"easeInOutExpo",complete:function(){return a===!0?$("#CMS_wrap").remove():$("#CMS_wrap").css({opacity:1})}})},toggle:function(){return k.util.is($("#CMS_panel"))?(k.panel.destroy,$("#cms_span").html("&gt;")):(k.panel.make(),k.panel.live(),$("#cms_span").html("x"))}},this.scroller={classify:function(a){var b,c;b=$("#"+a),c=b.data("scroller");if(c.axis==="horizontal"||!k.util.is(c.axis))return $(".cms_pane").removeClass("left").removeClass("clear").addClass("in-table"),b.addClass("nowrap");if(c.axis==="vertical")return b.removeClass("nowrap"),$(".cms_pane").removeClass("in-table").addClass("left").addClass("clear")},jump:function(a,b,c){var d,f,g,h,i,j;k.util.is(e)&&(e.preventDefault(),e.stopPropagation()),f=$("#"+k.config.scroller.frame),d=f.data("scroller"),g=k.util.is(b)?$.extend({},k.config.scroller.animation,{complete:b}):k.config.scroller.animation,i=f.offset(),j=$("#"+a).offset();if(d.axis==="vertical")return h=Math.floor(j.top-i.top),f.animate({scrollTop:"+="+h},g);if(d.axis==="horizontal")return h=Math.floor(j.left-i.left),f.animate({scrollLeft:"+="+h},g)}},this.pop={pop:function(a){var b,c,d,e,f,g,h,i,j;return j=k,b=$("#"+a),f="pop_"+a,d=f+"_button",h=k.config.pop.position,e=b.html(),i=b.prev().attr("id"),$b.unbind("click"),c=$.extend({},k.config.pop.animation,{complete:function(){return b.remove(),$("#"+d).html("pop back in"),j.util.bind($("#"+d),"click",j.util.wrap(j.pop.reset,a,"CMS_frame")),j.util.makeDragDrop(document.getElementById("upload"))}}),g='<div id="'+f+'" class="fixed panel" style="opacity:0;">'+e+"</div>",$("body").append(g),$("#"+f).css({bottom:"0px",right:h.right,"z-index":989}),$("#"+f).animate({bottom:h.bottom,opacity:1},c),k.scroller.jump(i)},reset:function(a,b){var c,d,e,f,g;return b===!1||!k.util.is(b)?$("#pop_"+a).remove():(g=k,f="pop_"+iD,c=$("#"+b),e=f+"_button",$(e).unbind("click"),d=$.extend({},k.config.pop.animation,{complete:function(){return $("#"+f).remove(),$("#"+e).html("pop me out"),g.util.bind($("#"+e),"click",g.util.wrap(g.pop.pop,a)),g.util.makeDragDrop(document.getElementById("upload"))}}))}},this.modal={show:function(a,b,d){var e,f,g,h,i,j;return e={opacity:1},i=this.util.is(d)?$.extend({},this.config.modal.animation,{complete:d}):this.config.modal.animation,j=this.config.modal.html.split("*****"),f=j[0]+b+j[1],h=Math.floor(this.config.modal.ratio.x*c.innerWidth),g=Math.floor(this.config.modal.ratio.y*c.innerHeight),e.width=h+"px",e.height=g+"px",e.top=Math.floor((c.innerHeight-g)/2),e.left=Math.floor((c.innerWidth-h)/2),$("body").append(this.config.overlay),$("#m-overlay").animate({opacity:.5},{duration:400,easing:"easeInOutExpo",complete:function(){return this.util.bind($("#m-overlay"),"click",this.modal.hide)}}),$("body").append(f),$("#modal-wrap").css({opacity:1}),this.config.modal.rounded&&$("#modal").addClass("rounded"),$("#modal").css(this.config.modal.initial),$("#modal").animate(e,i),this.util.bind($("#mod-close"),"click",this.modal.hide)},hide:function(){var a,b;return a=$("#modal"),b=$.extend({},this.config.modal.initial,{left:"0px",width:c.innerWidth,right:"0px",opacity:.5}),setTimeout(function(){return a.removeClass("rounded"),a.css({padding:0})},150),a.animate(b,{duration:400,easing:"easeInOutExpo",complete:function(){return a.animate({opacity:0},{duration:250,easing:"easeInOutExpo"}),$("#m-overlay").animate({opacity:0},{duration:500,easing:"easeInOutExpo",complete:function(){return $("#m-overlay").remove(),$("#modal_wrap").remove()}})}})}},a.dev.verbose("CMS","Initializing Momentum extensible management system..."),j=this,$("body").append(this.config.panel.status_html),setTimeout(function(){return $("#cms_span").animate({opacity:1},{duration:450,easing:"easeInOutExpo"}),$("#cms_edit_on").animate({opacity:1,left:"-155px"},{duration:400,easing:"easeInOutExpo",complete:function(){return setTimeout(function(){return $("#cms_edit_on").animate({left:"-290px"},{duration:400,easing:"easeInOutExpo",complete:function(){return j.util.bind($("#cms_edit_on"),"click",j.panel.toggle),j.panel.toggle()}})},1750)}})},500),$(".editable").each(function(){var a=this;j.util.bind($(a),"click",j.util.wrap(j.edit,a))})}return S(b,a),b.mount="content",b.events=[],b}(l),this.__apptools_preinit.abstract_base_classes.push(j),this.__apptools_preinit.deferred_core_modules.push({module:j,"package":"admin"}),b=function(){function a(a){var b,c,d,e,f,g=this;this.config={rpc:{base_uri:"/_api/rpc",host:null,enabled:!0},sockets:{host:null,enabled:!1}},this.lib={},this.sys={platform:{},version:this.version,core_events:["SYS_MODULE_LOADED","SYS_LIB_LOADED","SYS_DRIVER_LOADED"],state:{status:"NOT_READY",flags:["base"],modules:{},classes:{},interfaces:{},integrations:[],add_flag:function(a){return this.sys.flags.push(a)},consider_preinit:function(b){var c,d,e,f,h,i,j,k,l,m,n,o;if(b.abstract_base_classes!=null){m=b.abstract_base_classes;for(f=0,j=m.length;f<j;f++){c=m[f],g.sys.state.classes[c.name]=c,c.package!=null&&g.sys.state.modules[c.package]!=null&&(g.sys.state.modules[c.package].classes[c.name]=c);if(c["export"]!=null&&c["export"]==="private")continue;a[c.name]=c}}if(b.deferred_library_integrations!=null){n=b.deferred_library_integrations;for(h=0,k=n.length;h<k;h++)e=n[h],g.sys.libraries.install(e.name,e.library)}if(b.abstract_feature_interfaces!=null){o=b.abstract_feature_interfaces;for(i=0,l=o.length;i<l;i++)d=o[i],g.sys.interfaces.install(d.name,d.adapter)}return b}},modules:{install:function(b,c,d){var e,f,h,i;return c==null&&(c=null),d==null&&(d=null),c!=null&&(typeof c=="function"?(d=c,f=null):f=c),f!=null?(g[f]==null&&(g[f]={}),f=g[f],h=!0):(f=g,h=!1),b.mount!=null?e=b.mount:e=b.name.toLowerCase(),b.events!=null&&g.events!=null&&g.events.register(b.events),f[e]==null&&(h?(i=f[e]=new b(g,f,a),g.sys.state.modules[e]={module:i,classes:{}}):(i=f[e]=new b(g,a),g.sys.state.modules[e]={module:i,classes:{}})),b._init!=null&&b._init(g),g.dev!=null&&g.dev.verbose!=null&&g.dev.verbose("ModuleLoader","Installed module:",i," at mountpoint: ",f," under the name: ",e),g.events!=null&&g.events.trigger("SYS_MODULE_LOADED",{module:i,mountpoint:f}),d!=null&&d(i),i}},libraries:{install:function(a,b,c){return c==null&&(c=null),g.lib[a.toLowerCase()]=b,g.sys.state.integrations.push(a.toLowerCase()),g.dev.verbose("LibLoader",a+" detected."),g.events.trigger("SYS_LIB_LOADED",{name:a,library:b}),c!=null&&c(b,a),g.lib[a.toLowerCase()]},resolve:function(a){var b,c,d,e;a=a.toLowerCase(),e=g.sys.state.integrations;for(c=0,d=e.length;c<d;c++){b=e[c];if(b!==a)continue;return g.lib[a.toLowerCase()]}}},interfaces:{install:function(a,b){return g.dev.verbose("InterfaceLoader",'Installed "'+a+'" interface.'),g.events.trigger("SYS_INTERFACE_LOADED",{name:a,adapter:b}),g.sys.state.interfaces[a]={adapter:b,methods:b.methods},g.sys.state.interfaces[a]},resolve:function(a){return g.sys.state.interfaces[a]!=null?g.sys.state.interfaces[a]:!1}},drivers:{query:{},loader:{},transport:{},storage:{},render:{},install:function(a,b,c,d,e,f,h){return h==null&&(h=null),g.sys.drivers[a][b]={name:b,driver:d,enabled:e,priority:f,"interface":c},h!=null&&h(g.sys.drivers[a][b].driver),g.events.trigger("SYS_DRIVER_LOADED",g.sys.drivers[a][b]),g.sys.drivers[a][b]},resolve:function(a,b,c){var d,e,f;b==null&&(b=null),c==null&&(c=!1);if(g.sys.drivers[a]==null){apptools.dev.critical("CORE",'Unkown driver type "'+a+'".');return}if(b!=null)return g.sys.drivers[a][b]!=null?g.sys.drivers[a][b].driver:(c&&apptools.dev.critical("CORE","Could not resolve driver ",b," of type ",a,"."),!1);e=-1,f=!1;for(d in g.sys.drivers[a]){d=g.sys.drivers[a][d];if(d.priority>e){f=d;break}}return f}},go:function(){return g.dev.log("Core","All systems go."),g.sys.state.status="READY",g}},this.sys.modules.install(n,function(a){return a.verbose("CORE","CoreDevAPI is up and running.")}),this.sys.modules.install(p,function(a){return a.register(g.sys.core_events)}),a.__apptools_preinit!=null&&this.sys.state.consider_preinit(a.__apptools_preinit),(a!=null?a.Modernizr:void 0)!=null&&this.sys.libraries.install("Modernizr",a.Modernizr,function(a,b){return g.load=function(){var a,b;return a=1<=arguments.length?Q.call(arguments,0):[],(b=g.lib.modernizr).load.apply(b,a)}}),(a!=null?a.jQuery:void 0)!=null&&this.sys.libraries.install("jQuery",a.jQuery,function(a,b){return g.sys.drivers.install("query","jquery",g.sys.state.classes.QueryDriver,g.lib.jquery,!0,100,null),g.sys.drivers.install("transport","jquery",g.sys.state.classes.RPCDriver,g.lib.jquery,!0,100,null)}),(a!=null?a.Zepto:void 0)!=null&&this.sys.libraries.install("Zepto",a.Zepto,function(a,b){return g.sys.drivers.install("query","zepto",g.sys.state.classes.QueryDriver,g.lib.zepto,!0,500,null),g.sys.drivers.install("transport","zepto",g.sys.state.classes.RPCDriver,g.lib.zepto,!0,500,null)}),(a!=null?a._:void 0)!=null&&this.sys.libraries.install("Underscore",a._,function(a,b){return g.sys.drivers.install("query","underscore",g.sys.state.classes.QueryDriver,g.lib.underscore,!0,50,null),g.sys.drivers.install("render","underscore",g.sys.state.classes.RenderDriver,g.lib.underscore,!0,50,null)}),(a!=null?a.Backbone:void 0)!=null&&this.sys.libraries.install("Backbone",a.Backbone,function(b){return a.AppToolsView.prototype.apptools=g,a.AppToolsModel.prototype.apptools=g,a.AppToolsRouter.prototype.apptools=g,a.AppToolsCollection.prototype.apptools=g}),(a!=null?a.Lawnchair:void 0)!=null&&this.sys.libraries.install("Lawnchair",a.Lawnchair,function(a){return g.sys.drivers.install("storage","lawnchair",g.sys.state.classes.StorageDriver,g.lib.lawnchair,!0,500,function(a){return g.dev.verbose("Lawnchair","Storage is currently stubbed. Come back later.")})}),(a!=null?a.amplify:void 0)!=null&&this.sys.libraries.install("Amplify",a.amplify,function(a){return g.sys.drivers.register("transport","amplify",g.sys.state.classes.RPCDriver,g.lib.amplify,!0,500,null),g.sys.drivers.register("storage","amplify",g.sys.state.classes.StorageDriver,g.lib.amplify,!0,100,null)}),(a!=null?a.Milk:void 0)!=null&&this.sys.libraries.install("Milk",a.Milk,function(a){return g.sys.drivers.install("render","milk",g.sys.state.classes.RenderDriver,g.lib.milk,!0,100,function(a){return g.dev.verbose("Milk","Render support is currently stubbed. Come back later.")})}),(a!=null?a.Mustache:void 0)!=null&&this.sys.libraries.install("Mustache",a.Mustache,function(a){return g.sys.drivers.register("render","mustache",g.sys.state.classes.RenderDriver,g.lib.mustache,!0,500,function(a){return g.dev.verbose("Mustache","Render support is currently stubbed. Come back later.")})}),this.sys.modules.install(s),this.sys.modules.install(m),this.sys.modules.install(o),this.sys.modules.install(v),this.sys.modules.install(u),this.sys.modules.install(y),this.sys.modules.install(x),this.sys.modules.install(w);if(((e=a.__apptools_preinit)!=null?e.deferred_core_modules:void 0)!=null){f=a.__apptools_preinit.deferred_core_modules;for(c=0,d=f.length;c<d;c++)b=f[c],b.package!=null?this.sys.modules.install(b.module,b.package):this.sys.modules.install(b.module)}return this.sys.go()}return a.version={major:0,minor:1,micro:4,build:4282012,release:"BETA",get:function(){return[[[this.major.toString(),this.minor.toString(),this.micro.toString()].join("."),this.build.toString()].join("-"),this.release].join(" ")}},a}(),window.AppTools=b,window.apptools=new b(window),window.jQuery!=null?$.extend({apptools:window.apptools}):(window.$=function(a){return document.getElementById(a)},window.$.apptools=window.apptools)}).call(this);