(function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x=Array.prototype.slice,y=Object.prototype.hasOwnProperty,z=function(a,b){function d(){this.constructor=a}for(var c in b)y.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},A=function(a,b){return function(){return a.apply(b,arguments)}},B=Array.prototype.indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1};this.__apptools_preinit={},v={},q=function(a,b,c){var d,e,f,g,h,i,j,k;c==null&&(c=null);if(a===".")return b[b.length-1];j=a.split(/\./),a=j[0],g=2<=j.length?x.call(j,1):[];for(e=k=b.length-1;k<=-1?e<-1:e>-1;k<=-1?e++:e--){if(b[e]==null)continue;if(typeof b[e]=="object"&&a in(d=b[e])){c=d[a];break}continue}for(h=0,i=g.length;h<i;h++)f=g[h],c=q(f,[c]);return c instanceof Function&&(c=function(a){return function(){var b;return b=a.apply(d,arguments),b instanceof Function&&b.apply(null,arguments)||b}}(c)),c},p=function(){var a,b,c,d;return c=arguments[0],d=arguments[1],a=3<=arguments.length?x.call(arguments,2):[],function(){var e,f,g;g=[];for(e=0,f=d.length;e<f;e++)b=d[e],g.push(b.call.apply(b,[c].concat(x.call(a))));return g}().join("")},s=function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o,r,t,u,w,y,z,A,B,C,D,E,F,G,H,I;b==null&&(b=["{{","}}"]),c==null&&(c=null),j=v[F=b.join(" ")]||(v[F]={});if(a in j)return j[a];e=[],d=function(){var a,c;return c=b[0],a=b[1],RegExp("([\\s\\S]*?)([ \\t]*)(?:"+c+"\\s*(?:(!)\\s*([\\s\\S]+?)|(=)\\s*([\\s\\S]+?)\\s*=|({)\\s*(\\w[\\S]*?)\\s*}|([^0-9a-zA-Z._!={]?)\\s*([\\w.][\\S]*?))\\s*"+a+")","gm")},B=d(),B.lastIndex=y=(c||{start:0}).start,w=function(b,c){var d,e,f,g,h,i,j,k,m,n,o;(f=/$/gm).lastIndex=b,f.exec(a),n=a.substr(0,b).split("\n"),m=n.length,j=n[m-1],o=l+E.length,k=a.substr(o+1,b-o-1),h=(new Array(j.length-k.length+1)).join(" "),d=(new Array(k.length+1)).join("^"),j+=a.substr(b,f.lastIndex-b),g=new Error;for(i in e={message:""+c+"\n\nLine "+m+":\n"+j+"\n"+h+d,error:c,line:m,"char":h.length,tag:k})g[i]=e[i];return g};while(t=B.exec(a)){G=t.slice(1,3),k=G[0],E=G[1],D=t[3]||t[5]||t[7]||t[9],A=t[4]||t[6]||t[8]||t[10],l=y+k.length-1,y=B.lastIndex,r=(l===-1||a.charAt(l)==="\n")&&((H=a.charAt(y))===void 0||H===""||H==="\r"||H==="\n"),k&&e.push(function(a){return function(){return a}}(k)),r&&D!==""&&D!=="&"&&D!=="{"?(a.charAt(y)==="\r"&&(y+=1),a.charAt(y)==="\n"&&(y+=1)):E&&(e.push(function(a){return function(){return a}}(E)),l+=E.length,E="");switch(D){case"!":break;case"":case"&":case"{":f=function(a,b){return function(c){var d,e;return(d=(e=q(a,c))!=null?e:"")instanceof Function&&(d=p.apply(null,[this,s(""+d())].concat(x.call(arguments)))),b||(d=this.escape(""+d)),""+d}},e.push(f(A,D));break;case">":h=function(a,b){return function(c,d){var e;return e=d(a).toString(),b&&(e=e.replace(/^(?=.)/gm,b)),p.apply(null,[this,s(e)].concat(x.call(arguments)))}},e.push(h(A,E));break;case"#":case"^":z={name:A,start:y,error:w(B.lastIndex,"Unclosed section '"+A+"'!")},I=s(a,b,z),C=I[0],y=I[1],z["#"]=i=function(a,b,c){return function(d){var e,f,g,h;return h=q(a,d)||[],C=h instanceof Function?h(c):c,h instanceof Array||(h=[h]),e=s(C||"",b),d.push(h),f=function(){var a,b,c;c=[];for(a=0,b=h.length;a<b;a++)g=h[a],d[d.length-1]=g,c.push(p.apply(null,[this,e].concat(x.call(arguments))));return c}.apply(this,arguments),d.pop(),f.join("")}},z["^"]=g=function(a,b,c){return function(d){var e;return e=q(a,d)||[],e instanceof Array||(e=[1]),e=e.length===0?s(c,b):[],p.apply(null,[this,e].concat(x.call(arguments)))}},e.push(z[D](A,b,C));break;case"/":c==null?n="End Section tag '"+A+"' found, but not in section!":A!==(u=c.name)&&(n="End Section tag closes '"+A+"'; expected '"+u+"'!");if(n)throw w(B.lastIndex,n);return a=a.slice(c.start,l+1||9e9),j[a]=e,[a,y];case"=":(b=A.split(/\s+/)).length!==2&&(n="Set Delimiters tags should have two and only two values!");if(n)throw w(B.lastIndex,n);o=/[-[\]{}()*+?.,\\^$|#]/g,b=function(){var a,c,d;d=[];for(a=0,c=b.length;a<c;a++)m=b[a],d.push(m.replace(o,"\\$&"));return d}(),B=d();break;default:throw w(B.lastIndex,"Unknown tag type -- "+D)}B.lastIndex=y!=null?y:a.length}if(c!=null)throw c.error;return a.length!==y&&e.push(function(){return a.slice(y)}),j[a]=e},r={VERSION:"1.2.0",helpers:[],partials:null,escape:function(a){var b;return b={"&":"amp",'"':"quot","<":"lt",">":"gt"},a.replace(/[&"<>]/g,function(a){return"&"+b[a]+";"})},render:function(a,b,c){var d;return c==null&&(c=null),(c||(c=this.partials||{}))instanceof Function||(c=function(a){return function(b){if(b in a)return q(b,[a]);throw"Unknown partial '"+b+"'!"}}(c)),d=this.helpers instanceof Array?this.helpers:[this.helpers],p(this,s(a),d.concat([b]),c)}},this.__apptools_preinit={lib:{},abstract_base_classes:[]},f=function(){function a(){}return a}(),this.Backbone!=null?(this.__apptools_preinit.lib.backbone={enabled:!0,reference:this.Backbone},e=function(a){function b(){b.__super__.constructor.apply(this,arguments)}return z(b,a),b}(Backbone.View),c=function(a){function b(){b.__super__.constructor.apply(this,arguments)}return z(b,a),b}(Backbone.Model),d=function(a){function b(){b.__super__.constructor.apply(this,arguments)}return z(b,a),b}(Backbone.Router),b=function(a){function b(){b.__super__.constructor.apply(this,arguments)}return z(b,a),b}(Backbone.Collection)):(this.__apptools_preinit.lib.backbone={enabled:!1,reference:null},e=function(){function a(){}return a}(),c=function(){function a(){}return a}(),d=function(){function a(){}return a}(),b=function(){function a(){}return a}());if(typeof exports!="undefined"&&exports!==null){for(w in r)exports[w]=r[w];exports.CoreAPI=f,exports.AppToolsView=e,exports.AppToolsModel=c,exports.AppToolsRouter=d,exports.AppToolsCollection=b}else this.Milk=r,this.CoreAPI=f,this.__apptools_preinit.lib.milk={enabled:!0,reference:this.Milk},this.__apptools_preinit.abstract_base_classes.push(f),this.AppToolsView=e,this.AppToolsModel=c,this.AppToolsRouter=d,this.AppToolsCollection=b,this.__AppToolsBaseClasses={AppToolsView:e,AppToolsModel:c,AppToolsRouter:d,AppToolsCollection:b},this.__apptools_preinit.abstract_base_classes.push(e),this.__apptools_preinit.abstract_base_classes.push(c),this.__apptools_preinit.abstract_base_classes.push(d),this.__apptools_preinit.abstract_base_classes.push(b);h=function(a){function b(a){this.verbose=A(this.verbose,this),this.error=A(this.error,this),this.eventlog=A(this.eventlog,this),this.log=A(this.log,this),this.setDebug=A(this.setDebug,this),this.config={},this.environment={},this.performance={},this.debug={logging:!0,eventlog:!0,verbose:!0}}return z(b,a),b.prototype.setDebug=function(a){return this.debug=a,console.log("[CoreDev] Debug has been set.",this.debug)},b.prototype.log=function(){var a,b,c;c=arguments[0],b=arguments[1],a=3<=arguments.length?x.call(arguments,2):[],a==null&&(a="{no context}"),this.debug.logging===!0&&console.log.apply(console,["["+c+"] INFO: "+b].concat(x.call(a)))},b.prototype.eventlog=function(){var a,b;b=arguments[0],a=2<=arguments.length?x.call(arguments,1):[],a==null&&(a="{no context}"),this.debug.eventlog===!0&&console.log.apply(console,["[EventLog] "+b].concat(x.call(a)))},b.prototype.error=function(){var a,b,c;c=arguments[0],b=arguments[1],a=3<=arguments.length?x.call(arguments,2):[],this.debug.logging===!0&&console.log.apply(console,["["+c+"] ERROR: "+b].concat(x.call(a)))},b.prototype.verbose=function(){var a,b,c;c=arguments[0],b=arguments[1],a=3<=arguments.length?x.call(arguments,2):[],this.debug.verbose===!0&&this.log.apply(this,[c,b].concat(x.call(a)))},b}(f),k=function(a){function b(a){}return z(b,a),b}(f),j=function(a){function b(a){var b=this;this.registry=[],this.callchain={},this.history=[],this.trigger=function(){var a,c,d,e,f,g,h,i,j;d=arguments[0],a=2<=arguments.length?x.call(arguments,1):[],$.apptools.dev.verbose("Events","Triggered event.",d,a,b.callchain[d]);if(B.call(b.registry,d)>=0){f=0,e=0,j=b.callchain[d].hooks;for(h=0,i=j.length;h<i;h++){c=j[h];try{c.bridge===!0&&b.trigger.apply(b,[c.event].concat(x.call(a)));if(c.once===!0&&c.has_run===!0)continue;g=c.fn.apply(c,a),f++,b.history.push({event:d,callback:c,args:a,result:g}),c.has_run=!0}catch(k){e++,b.history.push({event:d,callback:c,args:a,error:k})}}return{executed:f,errors:e}}return!1},this.register=function(c){return b.registry.push(c),b.callchain[c]={hooks:[]},a.dev.verbose("Events","Registered event.",c),!0},this.on=this.when=this.hook=function(c,d,e){return e==null&&(e=!1),B.call(b.registry,c)<0&&b.register(c),b.callchain[c].hooks.push({fn:d,once:e,has_run:!1,bridge:!1}),a.dev.verbose("Events","Hook registered on event.",c),!0},this.bridge=function(c,d){var e,f,g,h,i;typeof d=="string"&&(d=[d]),typeof c=="string"&&(c=[c]),i=[];for(g=0,h=c.length;g<h;g++)e=c[g],i.push(function(){var b,c,g;g=[];for(b=0,c=d.length;b<c;b++)f=d[b],a.dev.verbose("Events","Bridging events.",e,"->",f),g.push(this.callchain[e].hooks.push({event:f,bridge:!0}));return g}.call(b));return i}}return z(b,a),b}(f),g=function(a){function b(a){this._data={},this.platform={},this.capabilities={},a.lib.modernizr!=null&&(this.capabilities=a.lib.modernizr),this._data={browsers:[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:window.opera,identity:"Opera"},{string:navigator.vendor,subString:"iCab",identity:"iCab"},{string:navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.vendor,subString:"Camino",identity:"Camino"},{string:navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}],os:[{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac"},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone/iPod"},{string:navigator.platform,subString:"Linux",identity:"Linux"}]}}return z(b,a),b.prototype._makeMatch=function(a){var b,c,d,e,f;for(e=0,f=a.length;e<f;e++){d=a[e],c=d.string,b=d.prop,this._data.versionSearchString=d.versionSearch||d.identity;if(c!==null){if(d.string.indexOf(d.subString)!==-1)return d.identity}else if(b)return d.identity}},b.prototype._makeVersion=function(a){var b;b=a.indexOf(this._data.versionSearchString);if(b!==-1)return parseFloat(a.substring(b+this._data.versionSearchString.length+1))},b.prototype.discover=function(){var a,b,c,d,e;a=this._makeMatch(this._data.browsers)||"unknown",e=this._makeVersion(navigator.userAgent)||this._makeVersion(navigator.appVersion)||"unknown",c=this._makeMatch(this._data.os)||"unknown";if(a==="iPod/iPhone"||a==="Android")d="mobile",b=!1;return this.platform={os:c,type:d,vendor:navigator.vendor,product:navigator.product,browser:a,version:e,flags:{mobile:b,webkit:$.browser.webkit,msie:$.browser.msie,opera:$.browser.opera,mozilla:$.browser.mozilla}},this.capabilities.simple={cookies:navigator.cookieEnabled,ajax:$.support.ajax}},b}(f),i=function(a){function b(a){var b=this;this.state={opened:!1,receiving:!1,error:!1,history:{errors:[],received:[]},pending:{},complete:{}},this.init=function(){return b.state.opened=!0,$.apptools.dev.verbose("Dispatch","Dispatch startup signal received.")},this.expect=function(a,c,d){return b.state.pending[a]={request:c,callbacks:callbacks,xhr:d},$.apptools.dev.verbose("Dispatch","Received EXPECT signal.",a,c,callbacks,d)},this.receive=function(a){var c,d,e,f,g;return d=JSON.parse(a.data),$.apptools.dev.verbose("Dispatch","Parsed async message.",d),b.state.history.received.push(a),d.status==="ok"?($.apptools.dev.verbose("Dispatch","Triggering deferred success callback."),b.state.complete[d.id]=b.state.pending[d.id],b.state.complete[d.id].response=d,$.apptools.dev.log("RPC","Success",a.data,d.status,b.state.complete[d.id].xhr),$.apptools.api.rpc.lastResponse=a.data,$.apptools.api.rpc.history[d.id].xhr=b.state.complete[d.id].xhr,$.apptools.api.rpc.history[d.id].status=d.status,$.apptools.api.rpc.history[d.id].response=a.data,c={xhr:b.state.complete[d.id].xhr,status:d.status,data:a.data},$.apptools.events.trigger("RPC_SUCCESS",c),$.apptools.events.trigger("RPC_COMPLETE",c),typeof (e=b.state.complete[d.id].callbacks).success=="function"?e.success(d.response.content):void 0):d.status==="notify"?($.apptools.dev.verbose("Dispatch","Received NOTIFY signal."),typeof (f=b.state.pending[d.id].callbacks).notify=="function"?f.notify(d.response.content):void 0):($.apptools.dev.error("Dispatch","Userland deferred task error. Calling error callback.",d),typeof (g=b.state.pending[d.id].callbacks).error=="function"?g.error(d.content):void 0)},this.error=function(a){return b.state.error=!0,b.history.errors.push(a),$.apptools.dev.error("Dispatch","Dispatch error state triggered.",a)},this.close=function(){return b.state.opened=!1,b.state.receiving=!1,$.apptools.dev.verbose("Dispatch","Dispatch shutdown signal received.")}}return z(b,a),b}(f),n=function(a){function b(a){var b=this;a.events.register("STORAGE_INIT"),a.events.register("STORAGE_READY"),a.events.register("STORAGE_ERROR"),a.events.register("STORAGE_ACTIVITY"),a.events.register("COLLECTION_SCAN"),a.events.register("COLLECTION_CREATE"),a.events.register("COLLECTION_DESTROY"),a.events.register("COLLECTION_UPDATE"),a.events.register("COLLECTION_SYNC"),a.events.register("STORAGE_READ"),a.events.register("STORAGE_WRITE"),a.events.register("STORAGE_DELETE"),this._state={runtime:{index:{key_read_tally:{},key_write_tally:{},local_by_key:{},local_by_kind:{}},count:{total_keys:0,by_collection:[],by_kind:[]},data:{}},config:{autoload:!1,autosync:{enabled:!1,interval:120},adapters:{},obfuscate:!1,local_only:!1,callbacks:{ready:null,sync:null}},supervisor:{},cachebridge:{},model_kind_map:{},collection_kind_map:{}},this.internal={check_support:function(a){},bootstrap:function(a){},provision_collection:function(a,b,c){}},this.get=function(){},this.list=function(){},this.count=function(){},this.put=function(){},this.query=function(){},this["delete"]=function(){},this.sync=function(){},this.enable=function(){return a.events.trigger("STORAGE_INIT"),a.events.trigger("STORAGE_READY")},a.events.bridge(["STORAGE_READ","STORAGE_WRITE","STORAGE_DELETE"],"STORAGE_ACTIVITY"),a.events.bridge(["COLLECTION_CREATE","COLLECTION_UPDATE","COLLECTION_DESTROY","COLLECTION_SYNC","COLLECTION_SCAN"],"STORAGE_ACTIVITY")}return z(b,a),b}(f),t=function(){function a(a,b,c,d){var e,f,g,h;this.name=a,this.base_uri=b,this.methods=c,this.config=d;if(this.methods.length>0){h=this.methods;for(f=0,g=h.length;f<g;f++)e=h[f],this[e]=this._buildRPCMethod(e,b,d)}}return a.prototype._buildRPCMethod=function(a,b,c){var d,e,f=this;return d=this.name,e=function(b,c,e,f,g){return b==null&&(b={}),c==null&&(c=null),e==null&&(e=!1),f==null&&(f=!1),g==null&&(g={}),function(b,c,e,f,g){var h;return h=$.apptools.api.rpc.createRPCRequest({method:a,api:d,params:b||{},opts:g||{},async:e||!1,push:f||!1}),c!==null?h.fulfill(c):h}(b,c,e,f,g)},$.apptools.api.registerAPIMethod(d,a,b,c),e},a}(),u=function(){function a(a,b,c){this.params={},this.action=null,this.method=null,this.api=null,this.base_uri=null,this.envelope={id:null,opts:{},agent:{}},this.ajax={accepts:"application/json",async:!0,cache:!0,global:!0,http_method:"POST",crossDomain:!1,processData:!1,ifModified:!1,dataType:"json",push:!1,contentType:"application/json; charset=utf-8"},a!=null&&(this.envelope.id=a),b!=null&&(this.envelope.opts=b),c!=null&&(this.envelope.agent=c)}return a.prototype.fulfill=function(a,b){var c,d,e=this;return a==null&&(a={}),(a!=null?a.success:void 0)==null&&(d=function(a,b,c){return $.apptools.dev.log("RPC","RPC succeeded but had no success callback.",e,a,b,c)},a.success=d),(a!=null?a.failure:void 0)==null&&(c=function(a){return $.apptools.dev.error("RPC","RPC failed but had no failure callback.",e,a)},a.failure=c),$.apptools.api.rpc.fulfillRPCRequest(b,this,a)},a.prototype.setAsync=function(a){var b;return(b=this.ajax)!=null&&b.async==null&&(b.async=a),this},a.prototype.setPush=function(a){return a===!0&&(this.ajax.push=!0,this.envelope.opts.alt="socket",this.envelope.opts.token=$.apptools.push.state.config.token),this},a.prototype.setOpts=function(a){var b,c;return(b=this.envelope)!=null&&(b.opts=_.defaults(a,(c=this.envelope)!=null?c.opts:void 0)),this},a.prototype.setAgent=function(a){var b;return(b=this.envelope)!=null&&b.agent==null&&(b.agent=a),this},a.prototype.setAction=function(a){return this.action=a,this},a.prototype.setMethod=function(a){return this.method=a,this},a.prototype.setAPI=function(a){return this.api=a,this},a.prototype.setBaseURI=function(a){return this.base_uri=a,this},a.prototype.setParams=function(a){return this.params=a!=null?a:{},this},a.prototype.payload=function(){var a;return a={id:this.envelope.id,opts:this.envelope.opts,agent:this.envelope.agent,request:{params:this.params,method:this.method,api:this.api}},a},a}(),m=function(a){function b(a){var b,c,d=this;a.events.register("RPC_CREATE"),a.events.register("RPC_FULFILL"),a.events.register("RPC_SUCCESS"),a.events.register("RPC_ERROR"),a.events.register("RPC_COMPLETE"),a.events.register("RPC_PROGRESS"),window.amplify!=null&&(a.dev.verbose("RPC","AmplifyJS detected. Registering."),(a!=null?(c=a.sys)!=null?c.drivers:void 0:void 0)&&a.sys.drivers.register("transport","amplify",window.amplify,!0,!0)),this.base_rpc_uri="/_api/rpc",b=$.ajaxSettings.xhr,this.internals={transports:{xhr:{factory:function(){var c;return c=b(),c&&typeof c.addEventListener=="function"&&c.addEventListener("progress",function(b){return a.events.trigger("RPC_PROGRESS",{event:b})},!1),c}}},config:{headers:{"X-ServiceClient":["AppToolsJS/",[a.sys.version.major.toString(),a.sys.version.minor.toString(),a.sys.version.micro.toString(),a.sys.version.build.toString()].join("."),"-",a.sys.version.release.toString()].join(""),"X-ServiceTransport":"AppTools/JSONRPC"}}},$.ajaxSetup({global:!0,xhr:function(){return d.internals.transports.xhr.factory()},headers:this.internals.config.headers}),this.rpc={lastRequest:null,lastFailure:null,lastResponse:null,action_prefix:null,alt_push_response:!1,history:{},used_ids:[],factory:function(a,b,c,d){return $.apptools.api[a]=new t(a,b,c,d)},_assembleRPCURL:function(a,b,c,d){b==null&&(b=null),c==null&&(c=null),d==null&&(d=null);if(b===null&&d===null)throw"[RPC] Error: Must specify either an API or base URI to generate an RPC endpoint.";return d===null&&(d=$.apptools.api.base_rpc_uri+"/"+b),c!==null?[c+d,a].join("."):[d,a].join(".")},provisionRequestID:function(){var a;return this.used_ids.length>0?(a=Math.max.apply(this,this.used_ids)+1,this.used_ids.push(a),a):(this.used_ids.push(1),1)},decodeRPCResponse:function(a,b,c,d,e){return d(a,b)},createRPCRequest:function(a){var b;return b=new u(this.provisionRequestID()),a.api!=null&&b.setAPI(a.api),a.method!=null&&b.setMethod(a.method),a.agent!=null&&b.setAgent(a.agent),a.opts!=null&&b.setOpts(a.opts),a.base_uri!=null&&b.setBaseURI(a.base_uri),a.params!=null&&b.setParams(a.params),a.async!=null&&b.setAsync(a.async),a.push!=null?b.setPush(a.push):b.setPush(this.alt_push_response),$.apptools.dev.verbose("RPC","New Request",b,a),b.setAction(this._assembleRPCURL(b.method,b.api,this.action_prefix,this.base_rpc_uri)),b},fulfillRPCRequest:function(b,c,d){var e;$.apptools.dev.verbose("RPC","Fulfill",b,c,d),this.lastRequest=c,this.history[c.envelope.id]={request:c,config:b,callbacks:d};if(c.action===null){if(c.method===null)throw"[RPC] Error: Request must specify at least an action or method.";if(c.base_uri===null){if(c.api===null)throw"[RPC] Error: Request must have an API or explicity BASE_URI.";c.action=this._assembleRPCURL(c.method,c.api,this.action_prefix)}else c.action=this._assembleRPCURL(c.method,null,this.action_prefix,c.base_uri)}if(c.action===null||c.action===void 0)throw"[RPC] Error: Could not determine RPC action.";return e={config:b,request:c,callbacks:d},$.apptools.events.trigger("RPC_FULFILL",e),function(b,c){var d,f,g,h,i,j,k=this;return a=window.apptools,h={resourceId:b.api+"."+b.method,url:b.action,data:JSON.stringify(b.payload()),async:b.ajax.async,global:b.ajax.global,type:b.ajax.http_method||"POST",accepts:b.ajax.accepts||"application/json",crossDomain:b.ajax.crossDomain,dataType:b.ajax.dataType,processData:!1,ifModified:b.ajax.ifModified,contentType:b.ajax.contentType,beforeSend:function(a,d){return $.apptools.api.rpc.history[b.envelope.id].xhr=a,c!=null&&typeof c.status=="function"&&c.status("beforeSend"),a},error:function(a,d,f){return c!=null&&typeof c.status=="function"&&c.status("error"),$.apptools.dev.error("RPC","Error: ",{error:f,status:d,xhr:a}),$.apptools.api.rpc.lastFailure=f,$.apptools.api.rpc.history[b.envelope.id].xhr=a,$.apptools.api.rpc.history[b.envelope.id].status=d,$.apptools.api.rpc.history[b.envelope.id].failure=f,e={xhr:a,status:d,error:f},$.apptools.events.trigger("RPC_ERROR",e),$.apptools.events.trigger("RPC_COMPLETE",e),c!=null?typeof c.failure=="function"?c.failure(f):void 0:void 0},success:function(a,d,f){return a.status==="ok"?(c!=null&&typeof c.status=="function"&&c.status("success"),$.apptools.dev.log("RPC","Success",a,d,f),$.apptools.api.rpc.lastResponse=a,$.apptools.api.rpc.history[b.envelope.id].xhr=f,$.apptools.api.rpc.history[b.envelope.id].status=d,$.apptools.api.rpc.history[b.envelope.id].response=a,e={xhr:f,status:d,data:a},$.apptools.events.trigger("RPC_SUCCESS",e),$.apptools.events.trigger("RPC_COMPLETE",e),c!=null?typeof c.success=="function"?c.success(a.response.content,a.response.type,a):void 0:void 0):a.status==="wait"?(c!=null&&typeof c.status=="function"&&c.status("wait"),$.apptools.dev.log("RPC","PushWait",a,d,f),e={xhr:f,status:d,data:a},c!=null&&typeof c.wait=="function"&&c.wait(a,d,f),$.apptools.push.internal.expect(b.envelope.id,b,f)):a.status==="fail"?(c!=null&&typeof c.status=="function"&&c.status("error"),$.apptools.dev.error("RPC","Error: ",{error:a,status:d,xhr:f}),$.apptools.api.rpc.lastFailure=a,$.apptools.api.rpc.history[b.envelope.id].xhr=f,$.apptools.api.rpc.history[b.envelope.id].status=d,$.apptools.api.rpc.history[b.envelope.id].failure=a,e={xhr:f,status:d,error:a},$.apptools.events.trigger("RPC_ERROR",e),$.apptools.events.trigger("RPC_COMPLETE",e),c!=null?typeof c.failure=="function"?c.failure(a):void 0:void 0):c!=null?typeof c.success=="function"?c.success(a.response.content,a.response.type,a):void 0:void 0},statusCode:{404:function(){return $.apptools.dev.error("RPC","HTTP/404","Could not resolve RPC action URI."),$.apptools.events.trigger("RPC_ERROR",{message:"RPC 404: Could not resolve RPC action URI.",code:404})},403:function(){return $.apptools.dev.error("RPC","HTTP/403","Not authorized to access the specified endpoint."),$.apptools.events.trigger("RPC_ERROR",{message:"RPC 403: Not authorized to access the specified endpoint.",code:403})},500:function(){return $.apptools.dev.error("RPC","HTTP/500","Internal server error."),$.apptools.events.trigger("RPC_ERROR",{message:"RPC 500: Woops! Something went wrong. Please try again.",code:500})}}},((i=$.apptools)!=null?(j=i.sys)!=null?j.drivers:void 0:void 0)?(d=$.apptools.sys.drivers.resolve("transport","amplify"),d!=null&&d===!0?($.apptools.dev.verbose("RPC","Fulfilling with AmplifyJS adapter."),g=d.request,f=g(h)):($.apptools.dev.verbose("RPC","Fulfilling with AJAX adapter.",h),f=$.ajax(h.url,h))):($.apptools.dev.verbose("RPC","Fulfilling with AJAX adapter.",h),f=$.ajax(h.url,h)),$.apptools.dev.verbose("RPC","Resulting XHR: ",f)}(c,d),{id:c.envelope.id,request:c}}},this.ext=null,this.registerAPIMethod=function(a,b,c,d){var e,f,g,h,i;if((h=$.apptools)!=null?(i=h.sys)!=null?i.drivers:void 0:void 0){e=$.apptools.sys.drivers.resolve("transport","amplify");if(e!==!1)return $.apptools.dev.log("RPCAPI",'Registering request procedure "'+a+"."+b+'" with AmplifyJS.'),g=a+"."+b,f={accepts:"application/json",type:"POST",dataType:"json",contentType:"application/json",url:this.api._assembleRPCURL(b,a,null,c),decoder:this.api.decodeRPCResponse},d.caching!=null?(d.caching===!0&&(f.caching="persist"),e.request.define(g,"ajax",f)):e.request.define(g,"ajax",f)}}}return z(b,a),b}(f),window.RPCAPI=t,window.RPCRequest=u,window.CoreRPCAPI=m,o=function(a){function b(a){var b=this;this.setUserInfo=function(a){return $.apptools.dev.log("UserAPI","Setting server-injected userinfo: ",a),b.current_user=a!=null?a.current_user:void 0}}return z(b,a),b}(f),l=function(a){function b(a){var b=this;a.events.register("PUSH_INIT"),a.events.register("PUSH_READY"),a.events.register("PUSH_STATE_CHANGE"),a.events.register("PUSH_CHANNEL_OPEN"),a.events.register("PUSH_SOCKET_ESTABLISH"),a.events.register("PUSH_SOCKET_ACTIVITY"),a.events.register("PUSH_SOCKET_ACTIVITY_FINISH"),a.events.register("PUSH_SOCKET_ERROR"),a.events.register("PUSH_CHANNEL_CLOSE"),this.state={ready:!1,status:null,transport:{socket:null,channel:null},callbacks:{open:null,expect:null,activity:null,error:null,close:null},config:{token:null}},a.events.hook("PUSH_READY",function(){var a,b;return a=1<=arguments.length?x.call(arguments,0):[],(b=$.apptools.events).trigger.apply(b,["PUSH_STATE_CHANGE"].concat(x.call(a)))}),a.events.hook("PUSH_SOCKET_ESTABLISH",function(){var a,b;return a=1<=arguments.length?x.call(arguments,0):[],(b=$.apptools.events).trigger.apply(b,["PUSH_STATE_CHANGE"].concat(x.call(a)))}),a.events.hook("PUSH_SOCKET_ERROR",function(){var a,b;return a=1<=arguments.length?x.call(arguments,0):[],(b=$.apptools.events).trigger.apply(b,["PUSH_STATE_CHANGE"].concat(x.call(a)))}),a.events.hook("PUSH_CHANNEL_OPEN",function(){var a,b;return a=1<=arguments.length?x.call(arguments,0):[],(b=$.apptools.events).trigger.apply(b,["PUSH_STATE_CHANGE"].concat(x.call(a))),$.apptools.api.rpc.alt_push_response=!0}),a.events.hook("PUSH_CHANNEL_CLOSE",function(){var a,b;return a=1<=arguments.length?x.call(arguments,0):[],(b=$.apptools.events).trigger.apply(b,["PUSH_STATE_CHANGE"].concat(x.call(a))),$.apptools.api.rpc.alt_push_response=!1}),this.events={on_open:function(){return $.apptools.dev.verbose("PushSocket","Message transport opened."),b.state.status="ready",a.events.trigger("PUSH_CHANNEL_OPEN",b.state)},on_message:function(c){var d;return $.apptools.dev.verbose("PushSocket","Message received.",c),b.state.status="receiving",a.events.trigger("PUSH_SOCKET_ACTIVITY",b.state),typeof (d=b.state.callbacks).activity=="function"&&d.activity(c),a.events.trigger("PUSH_SOCKET_ACTIVITY_FINISH",b.state)},on_error:function(c){return $.apptools.dev.error("PushSocket","Message transport error.",c),b.state.status="error",a.events.trigger("PUSH_SOCKET_ERROR",b.state)},on_close:function(){return $.apptools.dev.verbose("PushSocket","Message transport closed."),b.state.status="close",b.state.ready=!1,a.events.trigger("PUSH_CHANNEL_CLOSE",b.state)}},this.internal={open_channel:function(c){return a.events.trigger("PUSH_INIT",c),b.state.config.token=c,b.state.transport.channel=new goog.appengine.Channel(b.state.config.token),b.internal},open_socket:function(){return b.state.transport.socket=b.state.transport.channel.open(),a.events.trigger("PUSH_SOCKET_ESTABLISH",b.state.transport.socket),b.state.transport.socket.onopen=b.events.on_open,b.state.transport.socket.onmessage=b.events.on_message,b.state.transport.socket.onerror=b.events.on_error,b.state.transport.socket.onclose=b.events.on_close,b.internal},listen:function(a){return b.state.callbacks=_.defaults(a,b.state.callbacks),b.state.ready=!0,b.internal},expect:function(a,c,d){var e,f;return(e=b.state)!=null&&(f=e.callbacks)!=null&&typeof f.expect=="function"&&f.expect(a,c,d),b.internal}},this.establish=function(a,c){return b.state.status="init",b.internal.open_channel(a).open_socket().listen(c),b}}return z(b,a),b}(f),a=function(){function a(a){var b=this;return this.sys={version:{major:0,minor:1,micro:3,build:549897,release:"ALPHA"},platform:{}},this.lib={},(a!=null?a.Modernizr:void 0)!=null&&(this.lib.modernizr=a.Modernizr,this.load=function(a){return b.lib.modernizr.load(a)}),(a!=null?a.Backbone:void 0)!=null&&(this.lib.backbone=a.Backbone),(a!=null?a.Lawnchair:void 0)!=null&&(this.lib.lawnchair=a.Lawnchair),(a!=null?a.amplify:void 0)!=null&&(this.lib.amplify=a.amplify),(a!=null?a.jQuery:void 0)!=null&&(this.lib.jquery=a.jQuery),(a!=null?a.Milk:void 0)!=null&&(this.lib.milk=a.Milk),(a!=null?a.Mustache:void 0)!=null&&(this.lib.mustache=a.Mustache),this.dev=new h(this),this.model=new k(this),this.events=new j(this),this.agent=new g(this),this.agent.discover(),this.dispatch=new i(this),this.api=new m(this),this.user=new o(this),this.push=new l(this),this}return a}(),window.AppTools=a,window.apptools=new a(window),typeof $!="undefined"&&$!==null&&$.extend({apptools:window.apptools})}).call(this);